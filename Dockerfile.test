FROM python:3.9-slim

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV DEBIAN_FRONTEND=noninteractive
ENV PYTHONUNBUFFERED=1
ENV TEST_ENV=true
ENV DOCKER_ENV=true

# å®‰è£…åŸºç¡€ä¾èµ–
RUN apt-get update && apt-get install -y \
    git \
    wget \
    curl \
    build-essential \
    && rm -rf /var/lib/apt/lists/*

# åˆ›å»ºå·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . /app/

# å‡çº§ pip
RUN pip install --upgrade pip

# å®‰è£… Python ä¾èµ–
RUN pip install requests paramiko tqdm flask pytest pytest-cov pytest-asyncio pytest-mock pillow pyyaml psutil python-dotenv

# åˆ›å»ºå¿…è¦çš„ç›®å½•ç»“æ„
RUN mkdir -p /opt/retropie/emulators/nesticle \
    /opt/retropie/configs/nes \
    /home/pi/RetroPie/roms/nes \
    /home/pi/RetroPie/cheats \
    /home/pi/RetroPie/saves/nes \
    /usr/share/applications \
    /etc/systemd/system

# è®¾ç½®æƒé™
RUN chmod +x scripts/*.sh || true

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¯åŠ¨å‘½ä»¤
CMD ["python3", "-c", "print('ğŸ® GamePlayer-Raspberry Docker æµ‹è¯•ç¯å¢ƒå¯åŠ¨æˆåŠŸ!'); import http.server; import socketserver; import os; os.chdir('/app'); PORT = 8080; Handler = http.server.SimpleHTTPRequestHandler; httpd = socketserver.TCPServer(('', PORT), Handler); print(f'ğŸŒ HTTP æœåŠ¡å¯åŠ¨åœ¨ç«¯å£ {PORT}'); httpd.serve_forever()"]
