<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ GamePlayer-Raspberry</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: 'Courier New', monospace;
            color: white;
            text-align: center;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 {
            color: #00ff00;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 30px;
        }
        canvas {
            border: 3px solid #00ff00;
            border-radius: 10px;
            background: #000;
            box-shadow: 0 0 20px rgba(0,255,0,0.3);
        }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            border: 1px solid #00ff00;
        }
        .score {
            font-size: 24px;
            color: #ffff00;
            margin: 10px 0;
        }
        .instructions {
            margin: 20px 0;
            font-size: 16px;
            line-height: 1.6;
        }
        .key {
            background: #333;
            color: #00ff00;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 0 5px;
            border: 1px solid #00ff00;
        }

        /* Ê∏∏ÊàèÂàóË°®Ê†∑Âºè */
        .game-list {
            text-align: center;
            padding: 20px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .game-item {
            background: rgba(0,255,0,0.1);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .game-item:hover {
            background: rgba(0,255,0,0.2);
            border-color: #00ff88;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,255,0,0.3);
        }

        .game-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .game-title {
            font-size: 18px;
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 5px;
        }

        .game-desc {
            font-size: 12px;
            color: #88ff88;
            line-height: 1.4;
        }

        /* Ê∏∏ÊàèÁïåÈù¢Ê†∑Âºè */
        .game-interface {
            text-align: center;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 20px;
        }

        .back-btn {
            background: rgba(255,0,0,0.2);
            border: 1px solid #ff0000;
            color: #ff0000;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255,0,0,0.3);
            border-color: #ff4444;
        }

        /* ÊêúÁ¥¢ÂíåÁ≠õÈÄâÊ†∑Âºè */
        .search-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        #gameSearch {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid #00ff00;
            border-radius: 5px;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
            font-size: 16px;
        }

        #gameSearch:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0,255,0,0.3);
        }

        #systemFilter {
            padding: 10px;
            border: 2px solid #00ff00;
            border-radius: 5px;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
            font-size: 16px;
        }

        .settings-btn {
            padding: 10px 15px;
            border: 2px solid #ffaa00;
            border-radius: 5px;
            background: rgba(255,170,0,0.2);
            color: #ffaa00;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: rgba(255,170,0,0.3);
            border-color: #ffcc44;
        }

        /* Á≥ªÁªüÁΩëÊ†ºÊ†∑Âºè */
        .systems-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .system-item {
            background: rgba(0,100,255,0.1);
            border: 2px solid #0066ff;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .system-item:hover {
            background: rgba(0,100,255,0.2);
            border-color: #0088ff;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,100,255,0.3);
        }

        .system-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .system-name {
            font-size: 18px;
            font-weight: bold;
            color: #0088ff;
            margin-bottom: 5px;
        }

        .system-desc {
            font-size: 12px;
            color: #88ccff;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .system-count {
            font-size: 14px;
            color: #00ff00;
            font-weight: bold;
        }

        /* Ê∏∏ÊàèÂàóË°®ÂÆπÂô®Ê†∑Âºè */
        .games-container {
            margin-top: 20px;
        }

        .game-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .game-count {
            color: #00ff00;
            font-weight: bold;
        }

        /* Ê∏∏ÊàèÁ±ªÂûãÊ†∑Âºè */
        .game-type {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 3px;
            margin-top: 5px;
            display: inline-block;
        }

        .game-type.demo {
            background: rgba(255,170,0,0.2);
            color: #ffaa00;
            border: 1px solid #ffaa00;
        }

        .game-type.full {
            background: rgba(0,255,0,0.2);
            color: #00ff00;
            border: 1px solid #00ff00;
        }

        .game-size {
            font-size: 11px;
            color: #888;
            margin-top: 3px;
        }

        /* ËÆæÁΩÆÁïåÈù¢Ê†∑Âºè */
        .settings-interface {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .settings-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            gap: 20px;
        }

        .settings-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .settings-section {
            background: rgba(0,0,0,0.3);
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
        }

        .settings-section h4 {
            color: #00ff00;
            margin: 0 0 15px 0;
            font-size: 18px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .setting-item {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-item label {
            color: #ccc;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .setting-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #00ff00;
        }

        .setting-item input[type="range"] {
            flex: 1;
            accent-color: #00ff00;
        }

        .setting-item select {
            padding: 5px 10px;
            border: 1px solid #00ff00;
            border-radius: 3px;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
        }

        /* ÈáëÊâãÊåáËÆæÁΩÆÊ†∑Âºè */
        .cheat-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .cheat-system-select label {
            color: #00ff00;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .cheat-system-select select {
            width: 100%;
            padding: 8px;
            border: 2px solid #00ff00;
            border-radius: 5px;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
            font-size: 16px;
        }

        .cheat-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 5px;
            background: rgba(0,0,0,0.2);
        }

        .cheat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            background: rgba(0,0,0,0.3);
        }

        .cheat-info {
            flex: 1;
        }

        .cheat-name {
            color: #00ff00;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .cheat-desc {
            color: #888;
            font-size: 12px;
        }

        .cheat-code {
            color: #ffaa00;
            font-family: monospace;
            font-size: 11px;
            margin-top: 3px;
        }

        .cheat-toggle {
            margin-left: 10px;
        }

        .cheat-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #00ff00;
        }

        .cheat-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .action-btn {
            padding: 8px 16px;
            border: 2px solid;
            border-radius: 5px;
            background: rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .action-btn.enable {
            border-color: #00ff00;
            color: #00ff00;
        }

        .action-btn.enable:hover {
            background: rgba(0,255,0,0.2);
        }

        .action-btn.disable {
            border-color: #ff4444;
            color: #ff4444;
        }

        .action-btn.disable:hover {
            background: rgba(255,68,68,0.2);
        }

        .action-btn.reset {
            border-color: #ffaa00;
            color: #ffaa00;
        }

        .action-btn.reset:hover {
            background: rgba(255,170,0,0.2);
        }

        /* Ëá™Âä®ÂêØÁî®Ê†áÁ≠æÊ†∑Âºè */
        .auto-enable-label {
            font-size: 10px;
            background: rgba(0,255,255,0.2);
            color: #00ffff;
            border: 1px solid #00ffff;
            border-radius: 3px;
            padding: 1px 4px;
            margin-left: 5px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ GamePlayer-Raspberry</h1>

        <!-- Ê∏∏ÊàèÂàóË°®ÁïåÈù¢ -->
        <div id="gameList" class="game-list">
            <h2>üéÆ ÈÄâÊã©Ê∏∏ÊàèÁ≥ªÁªü</h2>

            <!-- ÊêúÁ¥¢ÂíåÁ≠õÈÄâ -->
            <div class="search-controls">
                <input type="text" id="gameSearch" placeholder="üîç ÊêúÁ¥¢Ê∏∏Êàè..." onkeyup="filterGames()">
                <select id="systemFilter" onchange="filterBySystem()">
                    <option value="">ÊâÄÊúâÁ≥ªÁªü</option>
                </select>
                <button onclick="showSettings()" class="settings-btn">‚öôÔ∏è ËÆæÁΩÆ</button>
            </div>

            <!-- Á≥ªÁªüÈÄâÊã© -->
            <div id="systemList" class="systems-grid">
                <!-- Á≥ªÁªüÂàóË°®Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
            </div>

            <!-- Ê∏∏ÊàèÂàóË°® -->
            <div id="gameListContainer" class="games-container" style="display: none;">
                <div class="game-list-header">
                    <button onclick="backToSystems()" class="back-btn">‚Üê ËøîÂõûÁ≥ªÁªüÈÄâÊã©</button>
                    <h3 id="currentSystemTitle">Ê∏∏ÊàèÂàóË°®</h3>
                    <div class="game-count">ÂÖ± <span id="gameCount">0</span> ‰∏™Ê∏∏Êàè</div>
                </div>
                <div id="gameGrid" class="games-grid">
                    <!-- Ê∏∏ÊàèÂàóË°®Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
                </div>
            </div>
        </div>

        <!-- Ê∏∏ÊàèÁïåÈù¢ -->
        <div id="gameInterface" class="game-interface" style="display: none;">
            <div class="game-header">
                <button onclick="backToGameList()" class="back-btn">‚Üê ËøîÂõûÊ∏∏ÊàèÂàóË°®</button>
                <h3 id="currentGameTitle">Â§™Á©∫Â∞ÑÂáª</h3>
                <div class="score">ÂæóÂàÜ: <span id="score">0</span></div>
            </div>
            <canvas id="gameCanvas" width="800" height="600"></canvas>
        </div>

        <!-- ËÆæÁΩÆÁïåÈù¢ -->
        <div id="settingsInterface" class="settings-interface" style="display: none;">
            <div class="settings-header">
                <button onclick="backToGameList()" class="back-btn">‚Üê ËøîÂõû</button>
                <h3>‚öôÔ∏è Ê∏∏ÊàèËÆæÁΩÆ</h3>
            </div>

            <div class="settings-content">
                <!-- ÈáëÊâãÊåáËÆæÁΩÆ -->
                <div class="settings-section">
                    <h4>üéØ ÈáëÊâãÊåáËÆæÁΩÆ</h4>
                    <div class="cheat-controls">
                        <div class="cheat-system-select">
                            <label>ÈÄâÊã©Ê∏∏ÊàèÁ≥ªÁªü:</label>
                            <select id="cheatSystemSelect" onchange="loadSystemCheats()">
                                <option value="">ËØ∑ÈÄâÊã©Á≥ªÁªü</option>
                            </select>
                        </div>

                        <div id="cheatList" class="cheat-list">
                            <!-- ÈáëÊâãÊåáÂàóË°®Â∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÂä†ËΩΩ -->
                        </div>

                        <div class="cheat-actions">
                            <button onclick="enableAllCheats()" class="action-btn enable">ÂêØÁî®ÊâÄÊúâ</button>
                            <button onclick="disableAllCheats()" class="action-btn disable">Á¶ÅÁî®ÊâÄÊúâ</button>
                            <button onclick="resetCheats()" class="action-btn reset">ÈáçÁΩÆ</button>
                        </div>
                    </div>
                </div>

                <!-- ÈÄöÁî®ËÆæÁΩÆ -->
                <div class="settings-section">
                    <h4>üéÆ ÈÄöÁî®ËÆæÁΩÆ</h4>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="autoSave" checked>
                            Ëá™Âä®‰øùÂ≠òÊ∏∏ÊàèËøõÂ∫¶
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="soundEnabled" checked>
                            ÂêØÁî®Èü≥Êïà
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="range" id="volumeSlider" min="0" max="100" value="80">
                            Èü≥Èáè: <span id="volumeValue">80</span>%
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="fullscreenMode">
                            ÂÖ®Â±èÊ®°Âºè
                        </label>
                    </div>
                </div>

                <!-- ÊéßÂà∂Âô®ËÆæÁΩÆ -->
                <div class="settings-section">
                    <h4>üéÆ ÊéßÂà∂Âô®ËÆæÁΩÆ</h4>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="gamepadEnabled" checked>
                            ÂêØÁî®USBÊâãÊüÑ
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="bluetoothEnabled" checked>
                            ÂêØÁî®ËìùÁâôÊâãÊüÑ
                        </label>
                    </div>
                    <div class="setting-item">
                        <button onclick="calibrateGamepad()" class="action-btn">Ê†°ÂáÜÊâãÊüÑ</button>
                    </div>
                </div>

                <!-- ÊòæÁ§∫ËÆæÁΩÆ -->
                <div class="settings-section">
                    <h4>üì∫ ÊòæÁ§∫ËÆæÁΩÆ</h4>
                    <div class="setting-item">
                        <label>
                            ÂàÜËæ®Áéá:
                            <select id="resolutionSelect">
                                <option value="800x600">800x600</option>
                                <option value="1024x768">1024x768</option>
                                <option value="1280x720">1280x720</option>
                                <option value="1920x1080" selected>1920x1080</option>
                            </select>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="smoothScaling" checked>
                            Âπ≥ÊªëÁº©Êîæ
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="scanlines">
                            Êâ´ÊèèÁ∫øÊïàÊûú
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="instructions">
                <h3>üïπÔ∏è Ê∏∏ÊàèÊéßÂà∂</h3>
                <p>
                    <span class="key">W</span> <span class="key">A</span> <span class="key">S</span> <span class="key">D</span> Êàñ ÊñπÂêëÈîÆ - ÁßªÂä®
                </p>
                <p>
                    <span class="key">Á©∫Ê†º</span> - ÂèëÂ∞ÑÂ≠êÂºπ | <span class="key">R</span> - ÈáçÊñ∞ÂºÄÂßã
                </p>
                <p>
                    <span class="key">ÁÇπÂáªÂ±èÂπï</span> - ÂêØÁî®Èü≥È¢ë
                </p>
            </div>

            <div class="audio-controls" style="margin-top: 20px;">
                <h3>üîä Èü≥È¢ëÊéßÂà∂</h3>
                <div style="margin: 10px 0;">
                    <label style="color: #00ff00;">‰∏ªÈü≥Èáè: </label>
                    <input type="range" id="masterVolume" min="0" max="100" value="80"
                           style="width: 150px;" onchange="updateMasterVolume(this.value)">
                    <span id="masterVolumeValue">80%</span>
                </div>
                <div style="margin: 10px 0;">
                    <label style="color: #00ff00;">Èü≥ÊïàÈü≥Èáè: </label>
                    <input type="range" id="sfxVolume" min="0" max="100" value="70"
                           style="width: 150px;" onchange="updateSfxVolume(this.value)">
                    <span id="sfxVolumeValue">70%</span>
                </div>
                <div style="margin: 10px 0;">
                    <label style="color: #00ff00;">Èü≥‰πêÈü≥Èáè: </label>
                    <input type="range" id="musicVolume" min="0" max="100" value="30"
                           style="width: 150px;" onchange="updateMusicVolume(this.value)">
                    <span id="musicVolumeValue">30%</span>
                </div>
                <div style="margin: 10px 0;">
                    <button onclick="toggleAudio()" style="
                        background: rgba(0,255,0,0.2);
                        border: 1px solid #00ff00;
                        color: #00ff00;
                        padding: 5px 15px;
                        border-radius: 5px;
                        cursor: pointer;
                    ">üîä ÂàáÊç¢Èü≥È¢ë</button>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>üéØ Ê∏∏ÊàèÁõÆÊ†á</h3>
            <p>ÊéßÂà∂ÁªøËâ≤È£ûËàπÔºåÂ∞ÑÂáªÁ∫¢Ëâ≤Êïå‰∫∫ÔºåÈÅøÂÖçÁ¢∞ÊíûÔºÅ</p>
            <p>ËøôÊòØ‰∏Ä‰∏™ÁªèÂÖ∏ÁöÑNESÈ£éÊ†ºÂ∞ÑÂáªÊ∏∏Êàè</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');

        // Èü≥È¢ëÁ≥ªÁªü
        class AudioSystem {
            constructor() {
                this.audioContext = null;
                this.sounds = {};
                this.musicGain = null;
                this.sfxGain = null;
                this.masterGain = null;
                this.initialized = false;
                this.musicVolume = 0.3;
                this.sfxVolume = 0.7;
                this.masterVolume = 0.8;
            }

            async initialize() {
                try {
                    // ÂàõÂª∫Èü≥È¢ë‰∏ä‰∏ãÊñá
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();

                    // ÂàõÂª∫Èü≥ÈáèÊéßÂà∂ËäÇÁÇπ
                    this.masterGain = this.audioContext.createGain();
                    this.musicGain = this.audioContext.createGain();
                    this.sfxGain = this.audioContext.createGain();

                    // ËøûÊé•Èü≥È¢ëËäÇÁÇπ
                    this.masterGain.connect(this.audioContext.destination);
                    this.musicGain.connect(this.masterGain);
                    this.sfxGain.connect(this.masterGain);

                    // ËÆæÁΩÆÂàùÂßãÈü≥Èáè
                    this.masterGain.gain.value = this.masterVolume;
                    this.musicGain.gain.value = this.musicVolume;
                    this.sfxGain.gain.value = this.sfxVolume;

                    // ÁîüÊàêÈü≥Êïà
                    await this.generateSounds();

                    this.initialized = true;
                    console.log('üîä Èü≥È¢ëÁ≥ªÁªüÂàùÂßãÂåñÊàêÂäü');

                } catch (error) {
                    console.error('‚ùå Èü≥È¢ëÁ≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•:', error);
                }
            }

            async generateSounds() {
                // ÁîüÊàêÂêÑÁßçÈü≥Êïà
                this.sounds.shoot = await this.createTone(800, 0.1, 'square');
                this.sounds.hit = await this.createTone(300, 0.2, 'sawtooth');
                this.sounds.powerup = await this.createChord([440, 554, 659], 0.3);
                this.sounds.explosion = await this.createNoise(0.3);
                this.sounds.gameOver = await this.createTone(200, 1.0, 'triangle');
                this.sounds.background = await this.createBackgroundMusic();
            }

            async createTone(frequency, duration, waveType = 'sine') {
                const sampleRate = this.audioContext.sampleRate;
                const frameCount = sampleRate * duration;
                const buffer = this.audioContext.createBuffer(1, frameCount, sampleRate);
                const data = buffer.getChannelData(0);

                for (let i = 0; i < frameCount; i++) {
                    const t = i / sampleRate;
                    let value;

                    switch (waveType) {
                        case 'square':
                            value = Math.sin(2 * Math.PI * frequency * t) > 0 ? 0.3 : -0.3;
                            break;
                        case 'sawtooth':
                            value = 0.3 * (2 * (frequency * t % 1) - 1);
                            break;
                        case 'triangle':
                            value = 0.3 * (2 * Math.abs(2 * (frequency * t % 1) - 1) - 1);
                            break;
                        default: // sine
                            value = 0.3 * Math.sin(2 * Math.PI * frequency * t);
                    }

                    // Ê∑ªÂä†Ê∑°Âá∫ÊïàÊûú
                    const fadeOut = Math.max(0, 1 - (t / duration) * 2);
                    data[i] = value * fadeOut;
                }

                return buffer;
            }

            async createChord(frequencies, duration) {
                const sampleRate = this.audioContext.sampleRate;
                const frameCount = sampleRate * duration;
                const buffer = this.audioContext.createBuffer(1, frameCount, sampleRate);
                const data = buffer.getChannelData(0);

                for (let i = 0; i < frameCount; i++) {
                    const t = i / sampleRate;
                    let value = 0;

                    frequencies.forEach(freq => {
                        value += 0.1 * Math.sin(2 * Math.PI * freq * t);
                    });

                    // Ê∑ªÂä†Ê∑°Âá∫ÊïàÊûú
                    const fadeOut = Math.max(0, 1 - (t / duration) * 1.5);
                    data[i] = value * fadeOut;
                }

                return buffer;
            }

            async createNoise(duration) {
                const sampleRate = this.audioContext.sampleRate;
                const frameCount = sampleRate * duration;
                const buffer = this.audioContext.createBuffer(1, frameCount, sampleRate);
                const data = buffer.getChannelData(0);

                for (let i = 0; i < frameCount; i++) {
                    const t = i / sampleRate;
                    const value = (Math.random() * 2 - 1) * 0.2;

                    // Ê∑ªÂä†Ê∑°Âá∫ÊïàÊûú
                    const fadeOut = Math.max(0, 1 - (t / duration) * 3);
                    data[i] = value * fadeOut;
                }

                return buffer;
            }

            async createBackgroundMusic() {
                // ÂàõÂª∫ÁÆÄÂçïÁöÑËÉåÊôØÈü≥‰πêÂæ™ÁéØ
                const duration = 4.0; // 4ÁßíÂæ™ÁéØ
                const sampleRate = this.audioContext.sampleRate;
                const frameCount = sampleRate * duration;
                const buffer = this.audioContext.createBuffer(1, frameCount, sampleRate);
                const data = buffer.getChannelData(0);

                // ÁÆÄÂçïÁöÑÊóãÂæã
                const melody = [440, 494, 523, 587, 659, 587, 523, 494]; // A, B, C, D, E, D, C, B
                const noteDuration = duration / melody.length;

                for (let i = 0; i < frameCount; i++) {
                    const t = i / sampleRate;
                    const noteIndex = Math.floor(t / noteDuration);
                    const noteTime = (t % noteDuration) / noteDuration;
                    const frequency = melody[noteIndex % melody.length];

                    // ‰∏ªÊóãÂæã
                    let value = 0.1 * Math.sin(2 * Math.PI * frequency * t);

                    // Ê∑ªÂä†ÂíåÂ£∞
                    value += 0.05 * Math.sin(2 * Math.PI * (frequency * 0.75) * t);

                    // Èü≥Á¨¶Ê∑°ÂÖ•Ê∑°Âá∫
                    const envelope = Math.sin(Math.PI * noteTime);
                    data[i] = value * envelope;
                }

                return buffer;
            }

            playSound(soundName, volume = 1.0) {
                if (!this.initialized || !this.sounds[soundName]) {
                    return;
                }

                try {
                    const source = this.audioContext.createBufferSource();
                    const gainNode = this.audioContext.createGain();

                    source.buffer = this.sounds[soundName];
                    gainNode.gain.value = volume;

                    source.connect(gainNode);
                    gainNode.connect(this.sfxGain);

                    source.start();
                } catch (error) {
                    console.error('Êí≠ÊîæÈü≥ÊïàÂ§±Ë¥•:', error);
                }
            }

            playBackgroundMusic() {
                if (!this.initialized || !this.sounds.background) {
                    return;
                }

                try {
                    // ÂÅúÊ≠¢ÂΩìÂâçËÉåÊôØÈü≥‰πê
                    this.stopBackgroundMusic();

                    // ÂàõÂª∫Âæ™ÁéØÊí≠ÊîæÁöÑËÉåÊôØÈü≥‰πê
                    this.backgroundSource = this.audioContext.createBufferSource();
                    this.backgroundSource.buffer = this.sounds.background;
                    this.backgroundSource.loop = true;
                    this.backgroundSource.connect(this.musicGain);
                    this.backgroundSource.start();

                    console.log('üéµ ËÉåÊôØÈü≥‰πêÂºÄÂßãÊí≠Êîæ');
                } catch (error) {
                    console.error('Êí≠ÊîæËÉåÊôØÈü≥‰πêÂ§±Ë¥•:', error);
                }
            }

            stopBackgroundMusic() {
                if (this.backgroundSource) {
                    try {
                        this.backgroundSource.stop();
                        this.backgroundSource = null;
                    } catch (error) {
                        // ÂøΩÁï•Â∑≤ÂÅúÊ≠¢ÁöÑÈü≥Ê∫êÈîôËØØ
                    }
                }
            }

            setMasterVolume(volume) {
                this.masterVolume = Math.max(0, Math.min(1, volume));
                if (this.masterGain) {
                    this.masterGain.gain.value = this.masterVolume;
                }
            }

            setSfxVolume(volume) {
                this.sfxVolume = Math.max(0, Math.min(1, volume));
                if (this.sfxGain) {
                    this.sfxGain.gain.value = this.sfxVolume;
                }
            }

            setMusicVolume(volume) {
                this.musicVolume = Math.max(0, Math.min(1, volume));
                if (this.musicGain) {
                    this.musicGain.gain.value = this.musicVolume;
                }
            }
        }

        // ÂàõÂª∫Èü≥È¢ëÁ≥ªÁªüÂÆû‰æã
        const audioSystem = new AudioSystem();

        // Ê∏∏ÊàèÁä∂ÊÄÅ
        let score = 0;
        let gameRunning = true;
        let audioInitialized = false;
        let currentGame = null;
        let currentSystem = null;
        let romDatabase = null;
        let filteredGames = [];

        // ÂÜÖÁΩÆÊºîÁ§∫Ê∏∏ÊàèÊï∞ÊçÆ
        const demoGames = {
            'space-shooter': {
                title: 'Â§™Á©∫Â∞ÑÂáª',
                icon: 'üöÄ',
                description: 'ÁªèÂÖ∏ÁöÑÂ§™Á©∫Â∞ÑÂáªÊ∏∏Êàè',
                gameFunction: startSpaceShooter
            }
        };
        
        // Áé©ÂÆ∂
        const player = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 30,
            height: 30,
            speed: 5,
            color: '#00ff00'
        };

        // Â≠êÂºπÊï∞ÁªÑ
        const bullets = [];
        const bulletSpeed = 7;

        // Êïå‰∫∫Êï∞ÁªÑ
        const enemies = [];
        const enemySpeed = 2;

        // ÊåâÈîÆÁä∂ÊÄÅ
        const keys = {};

        // ÂàùÂßãÂåñÈü≥È¢ëÁ≥ªÁªü
        async function initializeAudio() {
            if (!audioInitialized) {
                await audioSystem.initialize();
                audioInitialized = true;

                // ÂºÄÂßãÊí≠ÊîæËÉåÊôØÈü≥‰πê
                audioSystem.playBackgroundMusic();

                // ÊòæÁ§∫Èü≥È¢ëÁä∂ÊÄÅ
                console.log('üîä Èü≥È¢ëÁ≥ªÁªüÂ∑≤ÂêØÂä®');
                showAudioStatus();
            }
        }

        function showAudioStatus() {
            const statusDiv = document.createElement('div');
            statusDiv.style.cssText = `
                position: fixed;
                top: 10px;
                left: 10px;
                background: rgba(0, 255, 0, 0.8);
                color: black;
                padding: 5px 10px;
                border-radius: 5px;
                font-size: 12px;
                z-index: 1000;
            `;
            statusDiv.textContent = 'üîä Èü≥È¢ëÂ∑≤ÂêØÁî®';
            document.body.appendChild(statusDiv);

            setTimeout(() => {
                document.body.removeChild(statusDiv);
            }, 2000);
        }

        // ‰∫ã‰ª∂ÁõëÂê¨
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            if (e.key === ' ') {
                e.preventDefault();
                shootBullet();
            }
            if (e.key.toLowerCase() === 'r') {
                resetGame();
            }

            // ÂàùÂßãÂåñÈü≥È¢ëÁ≥ªÁªüÔºàÈúÄË¶ÅÁî®Êà∑‰∫§‰∫íÔºâ
            if (!audioInitialized) {
                initializeAudio();
            }
        });

        // ÁÇπÂáª‰∫ã‰ª∂‰πüÂèØ‰ª•ÂàùÂßãÂåñÈü≥È¢ë
        document.addEventListener('click', () => {
            if (!audioInitialized) {
                initializeAudio();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        // Â∞ÑÂáªÂ≠êÂºπ
        function shootBullet() {
            bullets.push({
                x: player.x + player.width / 2,
                y: player.y,
                width: 4,
                height: 10,
                color: '#ffff00'
            });

            // Êí≠ÊîæÂ∞ÑÂáªÈü≥Êïà
            audioSystem.playSound('shoot', 0.5);
        }

        // ÂàõÂª∫Êïå‰∫∫
        function createEnemy() {
            enemies.push({
                x: Math.random() * (canvas.width - 30),
                y: -30,
                width: 25,
                height: 25,
                color: '#ff0000'
            });
        }

        // Êõ¥Êñ∞Ê∏∏Êàè
        function update() {
            if (!gameRunning) return;

            // ÁßªÂä®Áé©ÂÆ∂
            if (keys['w'] || keys['arrowup']) player.y = Math.max(0, player.y - player.speed);
            if (keys['s'] || keys['arrowdown']) player.y = Math.min(canvas.height - player.height, player.y + player.speed);
            if (keys['a'] || keys['arrowleft']) player.x = Math.max(0, player.x - player.speed);
            if (keys['d'] || keys['arrowright']) player.x = Math.min(canvas.width - player.width, player.x + player.speed);

            // Êõ¥Êñ∞Â≠êÂºπ
            for (let i = bullets.length - 1; i >= 0; i--) {
                bullets[i].y -= bulletSpeed;
                if (bullets[i].y < 0) {
                    bullets.splice(i, 1);
                }
            }

            // Êõ¥Êñ∞Êïå‰∫∫
            for (let i = enemies.length - 1; i >= 0; i--) {
                enemies[i].y += enemySpeed;
                if (enemies[i].y > canvas.height) {
                    enemies.splice(i, 1);
                }
            }

            // Ê£ÄÊü•Â≠êÂºπ‰∏éÊïå‰∫∫Á¢∞Êíû
            for (let i = bullets.length - 1; i >= 0; i--) {
                for (let j = enemies.length - 1; j >= 0; j--) {
                    if (bullets[i] && enemies[j] && 
                        bullets[i].x < enemies[j].x + enemies[j].width &&
                        bullets[i].x + bullets[i].width > enemies[j].x &&
                        bullets[i].y < enemies[j].y + enemies[j].height &&
                        bullets[i].y + bullets[i].height > enemies[j].y) {
                        
                        bullets.splice(i, 1);
                        enemies.splice(j, 1);
                        score += 10;
                        scoreElement.textContent = score;

                        // Êí≠ÊîæÂáª‰∏≠Èü≥Êïà
                        audioSystem.playSound('hit', 0.7);
                        break;
                    }
                }
            }

            // Ê£ÄÊü•Áé©ÂÆ∂‰∏éÊïå‰∫∫Á¢∞Êíû
            for (let enemy of enemies) {
                if (player.x < enemy.x + enemy.width &&
                    player.x + player.width > enemy.x &&
                    player.y < enemy.y + enemy.height &&
                    player.y + player.height > enemy.y) {
                    
                    gameRunning = false;

                    // Êí≠ÊîæÊ∏∏ÊàèÁªìÊùüÈü≥Êïà
                    audioSystem.playSound('gameOver', 1.0);
                    audioSystem.stopBackgroundMusic();

                    alert(`Ê∏∏ÊàèÁªìÊùüÔºÅÊúÄÁªàÂæóÂàÜ: ${score}\nÊåâRÈîÆÈáçÊñ∞ÂºÄÂßã`);
                }
            }

            // ÈöèÊú∫ÁîüÊàêÊïå‰∫∫
            if (Math.random() < 0.02) {
                createEnemy();
            }
        }

        // ÁªòÂà∂Ê∏∏Êàè
        function draw() {
            // Ê∏ÖÁ©∫ÁîªÂ∏É
            ctx.fillStyle = '#000011';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ÁªòÂà∂ÊòüÁ©∫ËÉåÊôØ
            ctx.fillStyle = '#ffffff';
            for (let i = 0; i < 50; i++) {
                const x = (Date.now() * 0.01 + i * 123) % canvas.width;
                const y = (Date.now() * 0.02 + i * 456) % canvas.height;
                ctx.fillRect(x, y, 1, 1);
            }

            // ÁªòÂà∂Áé©ÂÆ∂
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // ÁªòÂà∂Áé©ÂÆ∂ÁªÜËäÇ
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(player.x + 5, player.y + 5, 20, 5);
            ctx.fillRect(player.x + 12, player.y, 6, 15);

            // ÁªòÂà∂Â≠êÂºπ
            ctx.fillStyle = '#ffff00';
            for (let bullet of bullets) {
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            }

            // ÁªòÂà∂Êïå‰∫∫
            for (let enemy of enemies) {
                ctx.fillStyle = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                
                // Êïå‰∫∫ÁªÜËäÇ
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(enemy.x + 5, enemy.y + 5, 15, 3);
                ctx.fillRect(enemy.x + 10, enemy.y + 15, 5, 8);
            }

            // ÁªòÂà∂Ê∏∏ÊàèÊ†áÈ¢ò
            if (!gameRunning) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#ff0000';
                ctx.font = '48px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText('Ê∏∏ÊàèÁªìÊùü', canvas.width / 2, canvas.height / 2);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = '24px Courier New';
                ctx.fillText('Êåâ R ÈîÆÈáçÊñ∞ÂºÄÂßã', canvas.width / 2, canvas.height / 2 + 50);
            }
        }

        // ÈáçÁΩÆÊ∏∏Êàè
        function resetGame() {
            score = 0;
            scoreElement.textContent = score;
            gameRunning = true;
            bullets.length = 0;
            enemies.length = 0;
            player.x = canvas.width / 2;
            player.y = canvas.height - 50;

            // Êí≠ÊîæÂºÄÂßãÈü≥ÊïàÂπ∂ÈáçÊñ∞ÂºÄÂßãËÉåÊôØÈü≥‰πê
            audioSystem.playSound('powerup', 0.8);
            if (audioInitialized) {
                audioSystem.playBackgroundMusic();
            }
        }

        // Ê∏∏ÊàèÂæ™ÁéØ
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Èü≥È¢ëÊéßÂà∂ÂáΩÊï∞
        function updateMasterVolume(value) {
            const volume = value / 100;
            audioSystem.setMasterVolume(volume);
            document.getElementById('masterVolumeValue').textContent = value + '%';
        }

        function updateSfxVolume(value) {
            const volume = value / 100;
            audioSystem.setSfxVolume(volume);
            document.getElementById('sfxVolumeValue').textContent = value + '%';
        }

        function updateMusicVolume(value) {
            const volume = value / 100;
            audioSystem.setMusicVolume(volume);
            document.getElementById('musicVolumeValue').textContent = value + '%';
        }

        function toggleAudio() {
            if (audioInitialized) {
                // ÂàáÊç¢Èü≥È¢ëÂºÄÂÖ≥
                if (audioSystem.masterVolume > 0) {
                    audioSystem.setMasterVolume(0);
                    document.getElementById('masterVolume').value = 0;
                    document.getElementById('masterVolumeValue').textContent = '0%';
                } else {
                    audioSystem.setMasterVolume(0.8);
                    document.getElementById('masterVolume').value = 80;
                    document.getElementById('masterVolumeValue').textContent = '80%';
                }
            } else {
                initializeAudio();
            }
        }

        // ROMÊï∞ÊçÆÂ∫ìÂä†ËΩΩ
        async function loadROMDatabase() {
            try {
                const response = await fetch('rom_list.json');
                if (response.ok) {
                    romDatabase = await response.json();
                    console.log('üìö ROMÊï∞ÊçÆÂ∫ìÂä†ËΩΩÊàêÂäü:', romDatabase);
                    initializeGameList();
                } else {
                    console.warn('‚ö†Ô∏è ROMÊï∞ÊçÆÂ∫ìÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÊºîÁ§∫Ê®°Âºè');
                    initializeDemoMode();
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è ROMÊï∞ÊçÆÂ∫ìÂä†ËΩΩÂºÇÂ∏∏Ôºå‰ΩøÁî®ÊºîÁ§∫Ê®°Âºè:', error);
                initializeDemoMode();
            }
        }

        // ÂàùÂßãÂåñÊ∏∏ÊàèÂàóË°®
        function initializeGameList() {
            if (!romDatabase) {
                initializeDemoMode();
                return;
            }

            // Â°´ÂÖÖÁ≥ªÁªüÁ≠õÈÄâÂô®
            const systemFilter = document.getElementById('systemFilter');
            systemFilter.innerHTML = '<option value="">ÊâÄÊúâÁ≥ªÁªü</option>';

            for (const systemId in romDatabase.systems) {
                const system = romDatabase.systems[systemId];
                const option = document.createElement('option');
                option.value = systemId;
                option.textContent = system.name;
                systemFilter.appendChild(option);
            }

            // ÊòæÁ§∫Á≥ªÁªüÂàóË°®
            displaySystems();
        }

        // ÂàùÂßãÂåñÊºîÁ§∫Ê®°Âºè
        function initializeDemoMode() {
            console.log('üéÆ ÂêØÂä®ÊºîÁ§∫Ê®°Âºè');
            const systemList = document.getElementById('systemList');
            systemList.innerHTML = `
                <div class="system-item" onclick="selectDemoGame('space-shooter')">
                    <div class="system-icon">üöÄ</div>
                    <div class="system-name">ÊºîÁ§∫Ê∏∏Êàè</div>
                    <div class="system-desc">ÂÜÖÁΩÆÁöÑÊºîÁ§∫Ê∏∏Êàè</div>
                    <div class="system-count">1 ‰∏™Ê∏∏Êàè</div>
                </div>
            `;
        }

        // ÊòæÁ§∫Á≥ªÁªüÂàóË°®
        function displaySystems() {
            const systemList = document.getElementById('systemList');
            systemList.innerHTML = '';

            for (const systemId in romDatabase.systems) {
                const system = romDatabase.systems[systemId];

                const systemDiv = document.createElement('div');
                systemDiv.className = 'system-item';
                systemDiv.onclick = () => selectSystem(systemId);

                systemDiv.innerHTML = `
                    <div class="system-icon">${system.icon}</div>
                    <div class="system-name">${system.name}</div>
                    <div class="system-desc">${system.description}</div>
                    <div class="system-count">${system.rom_count} ‰∏™Ê∏∏Êàè</div>
                `;

                systemList.appendChild(systemDiv);
            }
        }

        // ÈÄâÊã©Ê∏∏ÊàèÁ≥ªÁªü
        function selectSystem(systemId) {
            currentSystem = systemId;
            const system = romDatabase.systems[systemId];

            // Êõ¥Êñ∞Ê†áÈ¢ò
            document.getElementById('currentSystemTitle').textContent = system.name;
            document.getElementById('gameCount').textContent = system.rom_count;

            // ÈöêËóèÁ≥ªÁªüÂàóË°®ÔºåÊòæÁ§∫Ê∏∏ÊàèÂàóË°®
            document.getElementById('systemList').style.display = 'none';
            document.getElementById('gameListContainer').style.display = 'block';

            // ÊòæÁ§∫Ê∏∏ÊàèÂàóË°®
            displayGames(system.games);

            // Êí≠ÊîæÈÄâÊã©Èü≥Êïà
            audioSystem.playSound('select', 0.8);
        }

        // ÊòæÁ§∫Ê∏∏ÊàèÂàóË°®
        function displayGames(games) {
            const gameGrid = document.getElementById('gameGrid');
            gameGrid.innerHTML = '';

            filteredGames = games;

            games.forEach((game, index) => {
                const gameDiv = document.createElement('div');
                gameDiv.className = 'game-item';
                gameDiv.onclick = () => selectROMGame(game, index);

                const gameType = game.demo ? 'ÊºîÁ§∫Áâà' : 'ÂÆåÊï¥Áâà';
                const typeClass = game.demo ? 'demo' : 'full';

                gameDiv.innerHTML = `
                    <div class="game-icon">üéÆ</div>
                    <div class="game-title">${game.name}</div>
                    <div class="game-desc">${game.description}</div>
                    <div class="game-type ${typeClass}">${gameType}</div>
                    <div class="game-size">${game.size}</div>
                `;

                gameGrid.appendChild(gameDiv);
            });
        }

        // ËøîÂõûÁ≥ªÁªüÈÄâÊã©
        function backToSystems() {
            document.getElementById('systemList').style.display = 'grid';
            document.getElementById('gameListContainer').style.display = 'none';
            currentSystem = null;

            // Êí≠ÊîæËøîÂõûÈü≥Êïà
            audioSystem.playSound('beep', 0.6);
        }

        // Ê∏∏ÊàèÈÄâÊã©ÂíåÂàáÊç¢ÂáΩÊï∞
        function selectGame(gameId) {
            if (demoGames[gameId]) {
                currentGame = gameId;

                // ÈöêËóèÊ∏∏ÊàèÂàóË°®ÔºåÊòæÁ§∫Ê∏∏ÊàèÁïåÈù¢
                document.getElementById('gameList').style.display = 'none';
                document.getElementById('gameInterface').style.display = 'block';

                // Êõ¥Êñ∞Ê∏∏ÊàèÊ†áÈ¢ò
                document.getElementById('currentGameTitle').textContent = demoGames[gameId].title;

                // ÈáçÁΩÆÂæóÂàÜ
                score = 0;
                document.getElementById('score').textContent = score;

                // Êí≠ÊîæÈÄâÊã©Èü≥Êïà
                audioSystem.playSound('select', 0.8);

                // ÂêØÂä®ÈÄâ‰∏≠ÁöÑÊ∏∏Êàè
                demoGames[gameId].gameFunction();

                console.log(`üéÆ ÂêØÂä®Ê∏∏Êàè: ${demoGames[gameId].title}`);
            }
        }

        // ÈÄâÊã©ROMÊ∏∏Êàè
        function selectROMGame(game, index) {
            currentGame = `${currentSystem}_${index}`;

            // ÈöêËóèÊ∏∏ÊàèÂàóË°®ÔºåÊòæÁ§∫Ê∏∏ÊàèÁïåÈù¢
            document.getElementById('gameList').style.display = 'none';
            document.getElementById('gameInterface').style.display = 'block';

            // Êõ¥Êñ∞Ê∏∏ÊàèÊ†áÈ¢ò
            document.getElementById('currentGameTitle').textContent = game.name;

            // ÈáçÁΩÆÂæóÂàÜ
            score = 0;
            document.getElementById('score').textContent = score;

            // Êí≠ÊîæÈÄâÊã©Èü≥Êïà
            audioSystem.playSound('select', 0.8);

            // ÂêØÂä®ROMÊ∏∏ÊàèÔºàÊºîÁ§∫Ê®°ÂºèÔºâ
            startROMGame(game);

            console.log(`üéÆ ÂêØÂä®ROMÊ∏∏Êàè: ${game.name}`);
        }

        // ÈÄâÊã©ÊºîÁ§∫Ê∏∏Êàè
        function selectDemoGame(gameId) {
            selectGame(gameId);
        }

        // ÊêúÁ¥¢ÂíåÁ≠õÈÄâÂäüËÉΩ
        function filterGames() {
            const searchTerm = document.getElementById('gameSearch').value.toLowerCase();

            if (!currentSystem || !romDatabase) {
                return;
            }

            const system = romDatabase.systems[currentSystem];
            let filtered = system.games;

            if (searchTerm) {
                filtered = system.games.filter(game =>
                    game.name.toLowerCase().includes(searchTerm) ||
                    game.description.toLowerCase().includes(searchTerm)
                );
            }

            displayGames(filtered);
            document.getElementById('gameCount').textContent = filtered.length;
        }

        // ÊåâÁ≥ªÁªüÁ≠õÈÄâ
        function filterBySystem() {
            const selectedSystem = document.getElementById('systemFilter').value;

            if (!selectedSystem) {
                displaySystems();
                return;
            }

            selectSystem(selectedSystem);
        }

        // ÊòæÁ§∫ËÆæÁΩÆÁïåÈù¢
        function showSettings() {
            // ÈöêËóèÊ∏∏ÊàèÂàóË°®ÔºåÊòæÁ§∫ËÆæÁΩÆÁïåÈù¢
            document.getElementById('gameList').style.display = 'none';
            document.getElementById('settingsInterface').style.display = 'block';

            // ÂàùÂßãÂåñËÆæÁΩÆÁïåÈù¢
            initializeSettings();

            // Êí≠ÊîæÈÄâÊã©Èü≥Êïà
            audioSystem.playSound('select', 0.8);
        }

        // ÂàùÂßãÂåñËÆæÁΩÆÁïåÈù¢
        function initializeSettings() {
            // Â°´ÂÖÖÈáëÊâãÊåáÁ≥ªÁªüÈÄâÊã©Âô®
            const cheatSystemSelect = document.getElementById('cheatSystemSelect');
            cheatSystemSelect.innerHTML = '<option value="">ËØ∑ÈÄâÊã©Á≥ªÁªü</option>';

            if (romDatabase && romDatabase.systems) {
                for (const systemId in romDatabase.systems) {
                    const system = romDatabase.systems[systemId];
                    const option = document.createElement('option');
                    option.value = systemId;
                    option.textContent = system.name;
                    cheatSystemSelect.appendChild(option);
                }
            }

            // ÂàùÂßãÂåñÈü≥ÈáèÊªëÂùó
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeValue = document.getElementById('volumeValue');
            volumeSlider.oninput = function() {
                volumeValue.textContent = this.value;
                audioSystem.setMasterVolume(this.value / 100);
            };
        }

        // Âä†ËΩΩÁ≥ªÁªüÈáëÊâãÊåá
        function loadSystemCheats() {
            const systemId = document.getElementById('cheatSystemSelect').value;
            const cheatList = document.getElementById('cheatList');

            if (!systemId) {
                cheatList.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">ËØ∑ÂÖàÈÄâÊã©Ê∏∏ÊàèÁ≥ªÁªü</div>';
                return;
            }

            // Ê®°ÊãüÈáëÊâãÊåáÊï∞ÊçÆÔºàÂÆûÈôÖÈ°πÁõÆ‰∏≠‰ºö‰ªéÊúçÂä°Âô®Âä†ËΩΩÔºâ
            const systemCheats = {
                "nes": {
                    "infinite_lives": {
                        "name": "Êó†ÈôêÁîüÂëΩ",
                        "description": "Ëé∑ÂæóÊó†ÈôêÁîüÂëΩÊï∞",
                        "code": "AEAEAE",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "infinite_time": {
                        "name": "Êó†ÈôêÊó∂Èó¥",
                        "description": "Êó∂Èó¥‰∏ç‰ºöÂáèÂ∞ë",
                        "code": "AAAAAA",
                        "enabled": false,
                        "auto_enable": false
                    },
                    "invincibility": {
                        "name": "Êó†ÊïåÊ®°Âºè",
                        "description": "ËßíËâ≤Êó†ÊïåÔºå‰∏ç‰ºöÂèó‰º§",
                        "code": "AEAEAE",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "level_select": {
                        "name": "ÂÖ≥Âç°ÈÄâÊã©",
                        "description": "ÂèØ‰ª•ÈÄâÊã©‰ªªÊÑèÂÖ≥Âç°",
                        "code": "AAAAAA",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "max_power": {
                        "name": "ÊúÄÂ§ßËÉΩÂäõ",
                        "description": "ÊâÄÊúâËÉΩÂäõÂÄºÊúÄÂ§ß",
                        "code": "AEAEAE",
                        "enabled": true,
                        "auto_enable": true
                    }
                },
                "snes": {
                    "infinite_lives": {
                        "name": "Êó†ÈôêÁîüÂëΩ",
                        "description": "Ëé∑ÂæóÊó†ÈôêÁîüÂëΩÊï∞",
                        "code": "7E0DBE:63",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "infinite_health": {
                        "name": "Êó†ÈôêË°ÄÈáè",
                        "description": "Ë°ÄÈáè‰∏ç‰ºöÂáèÂ∞ë",
                        "code": "7E0DBF:FF",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "invincibility": {
                        "name": "Êó†ÊïåÊ®°Âºè",
                        "description": "ËßíËâ≤Êó†ÊïåÔºå‰∏ç‰ºöÂèó‰º§",
                        "code": "7E0DC0:01",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "max_power": {
                        "name": "ÊúÄÂ§ßËÉΩÂäõ",
                        "description": "ÊâÄÊúâËÉΩÂäõÂÄºÊúÄÂ§ß",
                        "code": "7E0DC0:FF",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "level_select": {
                        "name": "ÂÖ≥Âç°ÈÄâÊã©",
                        "description": "ÂèØ‰ª•ÈÄâÊã©‰ªªÊÑèÂÖ≥Âç°",
                        "code": "7E0DC1:FF",
                        "enabled": true,
                        "auto_enable": true
                    }
                }
            };

            const cheats = systemCheats[systemId] || {};

            if (Object.keys(cheats).length === 0) {
                cheatList.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">ËØ•Á≥ªÁªüÊöÇÊó†ÂèØÁî®ÈáëÊâãÊåá</div>';
                return;
            }

            cheatList.innerHTML = '';

            for (const cheatId in cheats) {
                const cheat = cheats[cheatId];

                const cheatDiv = document.createElement('div');
                cheatDiv.className = 'cheat-item';

                // Ê∑ªÂä†Ëá™Âä®ÂêØÁî®Ê†áËØÜ
                const autoEnableLabel = cheat.auto_enable ? '<span class="auto-enable-label">üîÑ Ëá™Âä®ÂêØÁî®</span>' : '';

                cheatDiv.innerHTML = `
                    <div class="cheat-info">
                        <div class="cheat-name">${cheat.name} ${autoEnableLabel}</div>
                        <div class="cheat-desc">${cheat.description}</div>
                        <div class="cheat-code">‰ª£Á†Å: ${cheat.code}</div>
                    </div>
                    <div class="cheat-toggle">
                        <input type="checkbox" id="cheat_${systemId}_${cheatId}"
                               ${cheat.enabled ? 'checked' : ''}
                               onchange="toggleCheat('${systemId}', '${cheatId}', this.checked)">
                    </div>
                `;

                cheatList.appendChild(cheatDiv);
            }
        }

        // ÂàáÊç¢ÈáëÊâãÊåáÁä∂ÊÄÅ
        function toggleCheat(systemId, cheatId, enabled) {
            console.log(`üéØ ${enabled ? 'ÂêØÁî®' : 'Á¶ÅÁî®'}ÈáëÊâãÊåá: ${systemId} - ${cheatId}`);

            // Êí≠ÊîæÈü≥Êïà
            audioSystem.playSound(enabled ? 'powerup' : 'beep', 0.6);

            // ËøôÈáåÂ∫îËØ•Ë∞ÉÁî®ÂêéÁ´ØAPIÊù•ÂÆûÈôÖÂêØÁî®/Á¶ÅÁî®ÈáëÊâãÊåá
            // ÁõÆÂâçÂè™ÊòØÊºîÁ§∫ÂäüËÉΩ
        }

        // ÂêØÁî®ÊâÄÊúâÈáëÊâãÊåá
        function enableAllCheats() {
            const systemId = document.getElementById('cheatSystemSelect').value;
            if (!systemId) {
                alert('ËØ∑ÂÖàÈÄâÊã©Ê∏∏ÊàèÁ≥ªÁªü');
                return;
            }

            const checkboxes = document.querySelectorAll('#cheatList input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                checkbox.onchange();
            });

            console.log('üéØ Â∑≤ÂêØÁî®ÊâÄÊúâÈáëÊâãÊåá');
            audioSystem.playSound('powerup', 0.8);
        }

        // Á¶ÅÁî®ÊâÄÊúâÈáëÊâãÊåá
        function disableAllCheats() {
            const checkboxes = document.querySelectorAll('#cheatList input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.onchange();
            });

            console.log('üö´ Â∑≤Á¶ÅÁî®ÊâÄÊúâÈáëÊâãÊåá');
            audioSystem.playSound('beep', 0.6);
        }

        // ÈáçÁΩÆÈáëÊâãÊåáËÆæÁΩÆ
        function resetCheats() {
            if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâÈáëÊâãÊåáËÆæÁΩÆÂêóÔºü')) {
                disableAllCheats();
                console.log('üîÑ ÈáëÊâãÊåáËÆæÁΩÆÂ∑≤ÈáçÁΩÆ');
                audioSystem.playSound('beep', 0.8);
            }
        }

        // Ê†°ÂáÜÊâãÊüÑ
        function calibrateGamepad() {
            alert('üéÆ ÊâãÊüÑÊ†°ÂáÜÂäüËÉΩ\n\n1. Á°Æ‰øùÊâãÊüÑÂ∑≤ËøûÊé•\n2. Êåâ‰ΩèÊâÄÊúâÊåâÈîÆ5Áßí\n3. ÊùæÂºÄÊâÄÊúâÊåâÈîÆ\n4. Ê†°ÂáÜÂÆåÊàê');
        }

        // ÂêØÂä®ROMÊ∏∏ÊàèÔºàÊºîÁ§∫Ôºâ
        function startROMGame(game) {
            // ÊòæÁ§∫Ê∏∏Êàè‰ø°ÊÅØ
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');

            // Ê∏ÖÁ©∫ÁîªÂ∏É
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ÊòæÁ§∫Ê∏∏Êàè‰ø°ÊÅØ
            ctx.fillStyle = '#00ff00';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`üéÆ ${game.name}`, canvas.width/2, 80);

            ctx.font = '16px Arial';
            ctx.fillText(`Á≥ªÁªü: ${romDatabase.systems[currentSystem].name}`, canvas.width/2, 120);
            ctx.fillText(`ÊèèËø∞: ${game.description}`, canvas.width/2, 150);
            ctx.fillText(`Â§ßÂ∞è: ${game.size}`, canvas.width/2, 180);
            ctx.fillText(`Á±ªÂûã: ${game.demo ? 'ÊºîÁ§∫Áâà' : 'ÂÆåÊï¥Áâà'}`, canvas.width/2, 210);

            // ÊòæÁ§∫Ëá™Âä®ÂêØÁî®ÁöÑÈáëÊâãÊåá
            ctx.fillStyle = '#ffaa00';
            ctx.font = '18px Arial';
            ctx.fillText('üéØ Ëá™Âä®ÂêØÁî®ÈáëÊâãÊåá:', canvas.width/2, 260);

            ctx.fillStyle = '#00ff88';
            ctx.font = '14px Arial';
            const autoEnabledCheats = [
                '‚úÖ Êó†ÈôêÁîüÂëΩ - Ê∞∏‰∏çÊ≠ª‰∫°',
                '‚úÖ Êó†ÊïåÊ®°Âºè - ÂÖçÁñ´‰º§ÂÆ≥',
                '‚úÖ ÊúÄÂ§ßËÉΩÂäõ - ËÉΩÂäõÂÄºÊúÄÂ§ß',
                '‚úÖ ÂÖ≥Âç°ÈÄâÊã© - ‰ªªÊÑèÂÖ≥Âç°'
            ];

            autoEnabledCheats.forEach((cheat, index) => {
                ctx.fillText(cheat, canvas.width/2, 290 + index * 25);
            });

            ctx.fillStyle = '#ffaa00';
            ctx.font = '16px Arial';
            ctx.fillText('üöß Ê®°ÊãüÂô®ÂäüËÉΩÂºÄÂèë‰∏≠...', canvas.width/2, 420);

            ctx.fillStyle = '#88ff88';
            ctx.font = '14px Arial';
            ctx.fillText('Êåâ ESC ÈîÆËøîÂõûÊ∏∏ÊàèÂàóË°®', canvas.width/2, 450);

            // Ê®°ÊãüÊ∏∏ÊàèËøêË°å
            gameRunning = true;

            // Êí≠ÊîæÂêØÂä®Èü≥Êïà
            audioSystem.playSound('powerup', 0.8);

            // Ê∑ªÂä†ÈîÆÁõòÁõëÂê¨
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && currentGame && currentGame.includes('_')) {
                    backToGameList();
                }
            });
        }

        function backToGameList() {
            // ÂÅúÊ≠¢ÂΩìÂâçÊ∏∏Êàè
            gameRunning = false;

            // ÊòæÁ§∫Ê∏∏ÊàèÂàóË°®ÔºåÈöêËóèÂÖ∂‰ªñÁïåÈù¢
            document.getElementById('gameList').style.display = 'block';
            document.getElementById('gameInterface').style.display = 'none';
            document.getElementById('settingsInterface').style.display = 'none';

            // Êí≠ÊîæËøîÂõûÈü≥Êïà
            audioSystem.playSound('beep', 0.6);

            currentGame = null;
            console.log('üîô ËøîÂõûÊ∏∏ÊàèÂàóË°®');
        }

        // Ê∏∏ÊàèÂÆûÁé∞ÂáΩÊï∞
        function startSpaceShooter() {
            // ÂΩìÂâçÁöÑÂ§™Á©∫Â∞ÑÂáªÊ∏∏ÊàèÈÄªËæë
            gameRunning = true;
            gameLoop();
        }

        function startTetris() {
            // ‰øÑÁΩóÊñØÊñπÂùóÊ∏∏ÊàèÈÄªËæëÔºàÁÆÄÂåñÁâàÔºâ
            gameRunning = true;
            alert('üß© ‰øÑÁΩóÊñØÊñπÂùóÊ∏∏ÊàèÂç≥Â∞ÜÊé®Âá∫ÔºÅ');
            backToGameList();
        }

        function startSnake() {
            // Ë¥™ÂêÉËõáÊ∏∏ÊàèÈÄªËæëÔºàÁÆÄÂåñÁâàÔºâ
            gameRunning = true;
            alert('üêç Ë¥™ÂêÉËõáÊ∏∏ÊàèÂç≥Â∞ÜÊé®Âá∫ÔºÅ');
            backToGameList();
        }

        function startMario() {
            // Ë∂ÖÁ∫ßÈ©¨ÈáåÂ••Ê∏∏ÊàèÈÄªËæëÔºàÁÆÄÂåñÁâàÔºâ
            gameRunning = true;
            alert('üçÑ Ë∂ÖÁ∫ßÈ©¨ÈáåÂ••Ê∏∏ÊàèÂç≥Â∞ÜÊé®Âá∫ÔºÅ');
            backToGameList();
        }

        function startPacman() {
            // ÂêÉË±Ü‰∫∫Ê∏∏ÊàèÈÄªËæëÔºàÁÆÄÂåñÁâàÔºâ
            gameRunning = true;
            alert('üëª ÂêÉË±Ü‰∫∫Ê∏∏ÊàèÂç≥Â∞ÜÊé®Âá∫ÔºÅ');
            backToGameList();
        }

        function startContra() {
            // È≠ÇÊñóÁΩóÊ∏∏ÊàèÈÄªËæëÔºàÁÆÄÂåñÁâàÔºâ
            gameRunning = true;
            alert('üî´ È≠ÇÊñóÁΩóÊ∏∏ÊàèÂç≥Â∞ÜÊé®Âá∫ÔºÅ');
            backToGameList();
        }

        // ÂêØÂä®Ê∏∏ÊàèÁ≥ªÁªü
        console.log('üéÆ GamePlayer-Raspberry ÊµèËßàÂô®Ê∏∏ÊàèÂêØÂä®!');

        // Âä†ËΩΩROMÊï∞ÊçÆÂ∫ì
        loadROMDatabase();

        // ÊòæÁ§∫Ê∏∏ÊàèÂàóË°®ÔºàÈªòËÆ§ÁïåÈù¢Ôºâ
        document.getElementById('gameList').style.display = 'block';
        document.getElementById('gameInterface').style.display = 'none';
    </script>
</body>
</html>
