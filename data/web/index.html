<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ® GamePlayer-Raspberry</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: 'Courier New', monospace;
            color: white;
            text-align: center;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        h1 {
            color: #00ff00;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 30px;
        }
        canvas {
            border: 3px solid #00ff00;
            border-radius: 10px;
            background: #000;
            box-shadow: 0 0 20px rgba(0,255,0,0.3);
        }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            border: 1px solid #00ff00;
        }
        .score {
            font-size: 24px;
            color: #ffff00;
            margin: 10px 0;
        }
        .instructions {
            margin: 20px 0;
            font-size: 16px;
            line-height: 1.6;
        }
        .key {
            background: #333;
            color: #00ff00;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 0 5px;
            border: 1px solid #00ff00;
        }

        /* æ¸¸æˆåˆ—è¡¨æ ·å¼ */
        .game-list {
            text-align: center;
            padding: 20px;
        }

        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .game-item {
            background: rgba(0,255,0,0.1);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .game-item:hover {
            background: rgba(0,255,0,0.2);
            border-color: #00ff88;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,255,0,0.3);
        }

        .game-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .game-title {
            font-size: 18px;
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 5px;
        }

        .game-desc {
            font-size: 12px;
            color: #88ff88;
            line-height: 1.4;
        }

        /* æ¸¸æˆç•Œé¢æ ·å¼ */
        .game-interface {
            text-align: center;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 20px;
        }

        .back-btn {
            background: rgba(255,0,0,0.2);
            border: 1px solid #ff0000;
            color: #ff0000;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: rgba(255,0,0,0.3);
            border-color: #ff4444;
        }

        /* æœç´¢å’Œç­›é€‰æ ·å¼ */
        .search-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        #gameSearch {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid #00ff00;
            border-radius: 5px;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
            font-size: 16px;
        }

        #gameSearch:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0,255,0,0.3);
        }

        #systemFilter {
            padding: 10px;
            border: 2px solid #00ff00;
            border-radius: 5px;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
            font-size: 16px;
        }

        .settings-btn {
            padding: 10px 15px;
            border: 2px solid #ffaa00;
            border-radius: 5px;
            background: rgba(255,170,0,0.2);
            color: #ffaa00;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .settings-btn:hover {
            background: rgba(255,170,0,0.3);
            border-color: #ffcc44;
        }

        /* ç³»ç»Ÿç½‘æ ¼æ ·å¼ */
        .systems-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .system-item {
            background: rgba(0,100,255,0.1);
            border: 2px solid #0066ff;
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .system-item:hover {
            background: rgba(0,100,255,0.2);
            border-color: #0088ff;
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,100,255,0.3);
        }

        .system-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .system-name {
            font-size: 18px;
            font-weight: bold;
            color: #0088ff;
            margin-bottom: 5px;
        }

        .system-desc {
            font-size: 12px;
            color: #88ccff;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .system-count {
            font-size: 14px;
            color: #00ff00;
            font-weight: bold;
        }

        /* æ¸¸æˆåˆ—è¡¨å®¹å™¨æ ·å¼ */
        .games-container {
            margin-top: 20px;
        }

        .game-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 0 10px;
        }

        .game-count {
            color: #00ff00;
            font-weight: bold;
        }

        /* æ¸¸æˆç±»å‹æ ·å¼ */
        .game-type {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 3px;
            margin-top: 5px;
            display: inline-block;
        }

        .game-type.demo {
            background: rgba(255,170,0,0.2);
            color: #ffaa00;
            border: 1px solid #ffaa00;
        }

        .game-type.full {
            background: rgba(0,255,0,0.2);
            color: #00ff00;
            border: 1px solid #00ff00;
        }

        .game-size {
            font-size: 11px;
            color: #888;
            margin-top: 3px;
        }

        /* è®¾ç½®ç•Œé¢æ ·å¼ */
        .settings-interface {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .settings-header {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            gap: 20px;
        }

        .settings-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .settings-section {
            background: rgba(0,0,0,0.3);
            border: 1px solid #333;
            border-radius: 10px;
            padding: 20px;
        }

        .settings-section h4 {
            color: #00ff00;
            margin: 0 0 15px 0;
            font-size: 18px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }

        .setting-item {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-item label {
            color: #ccc;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .setting-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #00ff00;
        }

        .setting-item input[type="range"] {
            flex: 1;
            accent-color: #00ff00;
        }

        .setting-item select {
            padding: 5px 10px;
            border: 1px solid #00ff00;
            border-radius: 3px;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
        }

        /* é‡‘æ‰‹æŒ‡è®¾ç½®æ ·å¼ */
        .cheat-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .cheat-system-select label {
            color: #00ff00;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .cheat-system-select select {
            width: 100%;
            padding: 8px;
            border: 2px solid #00ff00;
            border-radius: 5px;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
            font-size: 16px;
        }

        .cheat-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            border: 1px solid #333;
            border-radius: 5px;
            background: rgba(0,0,0,0.2);
        }

        .cheat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 5px;
            background: rgba(0,0,0,0.3);
        }

        .cheat-info {
            flex: 1;
        }

        .cheat-name {
            color: #00ff00;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .cheat-desc {
            color: #888;
            font-size: 12px;
        }

        .cheat-code {
            color: #ffaa00;
            font-family: monospace;
            font-size: 11px;
            margin-top: 3px;
        }

        .cheat-toggle {
            margin-left: 10px;
        }

        .cheat-toggle input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: #00ff00;
        }

        .cheat-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .action-btn {
            padding: 8px 16px;
            border: 2px solid;
            border-radius: 5px;
            background: rgba(0,0,0,0.3);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .action-btn.enable {
            border-color: #00ff00;
            color: #00ff00;
        }

        .action-btn.enable:hover {
            background: rgba(0,255,0,0.2);
        }

        .action-btn.disable {
            border-color: #ff4444;
            color: #ff4444;
        }

        .action-btn.disable:hover {
            background: rgba(255,68,68,0.2);
        }

        .action-btn.reset {
            border-color: #ffaa00;
            color: #ffaa00;
        }

        .action-btn.reset:hover {
            background: rgba(255,170,0,0.2);
        }

        /* è‡ªåŠ¨å¯ç”¨æ ‡ç­¾æ ·å¼ */
        .auto-enable-label {
            font-size: 10px;
            background: rgba(0,255,255,0.2);
            color: #00ffff;
            border: 1px solid #00ffff;
            border-radius: 3px;
            padding: 1px 4px;
            margin-left: 5px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® GamePlayer-Raspberry</h1>

        <!-- æ¸¸æˆåˆ—è¡¨ç•Œé¢ -->
        <div id="gameList" class="game-list">
            <h2>ğŸ® é€‰æ‹©æ¸¸æˆç³»ç»Ÿ</h2>

            <!-- æœç´¢å’Œç­›é€‰ -->
            <div class="search-controls">
                <input type="text" id="gameSearch" placeholder="ğŸ” æœç´¢æ¸¸æˆ..." onkeyup="filterGames()">
                <select id="systemFilter" onchange="filterBySystem()">
                    <option value="">æ‰€æœ‰ç³»ç»Ÿ</option>
                </select>
                <button onclick="showSettings()" class="settings-btn">âš™ï¸ è®¾ç½®</button>
            </div>

            <!-- ç³»ç»Ÿé€‰æ‹© -->
            <div id="systemList" class="systems-grid">
                <!-- ç³»ç»Ÿåˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>

            <!-- æ¸¸æˆåˆ—è¡¨ -->
            <div id="gameListContainer" class="games-container" style="display: none;">
                <div class="game-list-header">
                    <button onclick="backToSystems()" class="back-btn">â† è¿”å›ç³»ç»Ÿé€‰æ‹©</button>
                    <h3 id="currentSystemTitle">æ¸¸æˆåˆ—è¡¨</h3>
                    <div class="game-count">å…± <span id="gameCount">0</span> ä¸ªæ¸¸æˆ</div>
                </div>
                <div id="gameGrid" class="games-grid">
                    <!-- æ¸¸æˆåˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="gameInterface" class="game-interface" style="display: none;">
            <div class="game-header">
                <button onclick="backToGameList()" class="back-btn">â† è¿”å›æ¸¸æˆåˆ—è¡¨</button>
                <h3 id="currentGameTitle">å¤ªç©ºå°„å‡»</h3>
                <div class="score">å¾—åˆ†: <span id="score">0</span></div>
            </div>
            <canvas id="gameCanvas" width="800" height="600"></canvas>
        </div>

        <!-- è®¾ç½®ç•Œé¢ -->
        <div id="settingsInterface" class="settings-interface" style="display: none;">
            <div class="settings-header">
                <button onclick="backToGameList()" class="back-btn">â† è¿”å›</button>
                <h3>âš™ï¸ æ¸¸æˆè®¾ç½®</h3>
            </div>

            <div class="settings-content">
                <!-- é‡‘æ‰‹æŒ‡è®¾ç½® -->
                <div class="settings-section">
                    <h4>ğŸ¯ é‡‘æ‰‹æŒ‡è®¾ç½®</h4>
                    <div class="cheat-controls">
                        <div class="cheat-system-select">
                            <label>é€‰æ‹©æ¸¸æˆç³»ç»Ÿ:</label>
                            <select id="cheatSystemSelect" onchange="loadSystemCheats()">
                                <option value="">è¯·é€‰æ‹©ç³»ç»Ÿ</option>
                            </select>
                        </div>

                        <div id="cheatList" class="cheat-list">
                            <!-- é‡‘æ‰‹æŒ‡åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </div>

                        <div class="cheat-actions">
                            <button onclick="enableAllCheats()" class="action-btn enable">å¯ç”¨æ‰€æœ‰</button>
                            <button onclick="disableAllCheats()" class="action-btn disable">ç¦ç”¨æ‰€æœ‰</button>
                            <button onclick="resetCheats()" class="action-btn reset">é‡ç½®</button>
                        </div>
                    </div>
                </div>

                <!-- é€šç”¨è®¾ç½® -->
                <div class="settings-section">
                    <h4>ğŸ® é€šç”¨è®¾ç½®</h4>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="autoSave" checked>
                            è‡ªåŠ¨ä¿å­˜æ¸¸æˆè¿›åº¦
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="soundEnabled" checked>
                            å¯ç”¨éŸ³æ•ˆ
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="range" id="volumeSlider" min="0" max="100" value="80">
                            éŸ³é‡: <span id="volumeValue">80</span>%
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="fullscreenMode">
                            å…¨å±æ¨¡å¼
                        </label>
                    </div>
                </div>

                <!-- æ§åˆ¶å™¨è®¾ç½® -->
                <div class="settings-section">
                    <h4>ğŸ® æ§åˆ¶å™¨è®¾ç½®</h4>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="gamepadEnabled" checked>
                            å¯ç”¨USBæ‰‹æŸ„
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="bluetoothEnabled" checked>
                            å¯ç”¨è“ç‰™æ‰‹æŸ„
                        </label>
                    </div>
                    <div class="setting-item">
                        <button onclick="calibrateGamepad()" class="action-btn">æ ¡å‡†æ‰‹æŸ„</button>
                    </div>
                </div>

                <!-- æ˜¾ç¤ºè®¾ç½® -->
                <div class="settings-section">
                    <h4>ğŸ“º æ˜¾ç¤ºè®¾ç½®</h4>
                    <div class="setting-item">
                        <label>
                            åˆ†è¾¨ç‡:
                            <select id="resolutionSelect">
                                <option value="800x600">800x600</option>
                                <option value="1024x768">1024x768</option>
                                <option value="1280x720">1280x720</option>
                                <option value="1920x1080" selected>1920x1080</option>
                            </select>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="smoothScaling" checked>
                            å¹³æ»‘ç¼©æ”¾
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>
                            <input type="checkbox" id="scanlines">
                            æ‰«æçº¿æ•ˆæœ
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div class="instructions">
                <h3>ğŸ•¹ï¸ æ¸¸æˆæ§åˆ¶</h3>
                <p>
                    <span class="key">W</span> <span class="key">A</span> <span class="key">S</span> <span class="key">D</span> æˆ– æ–¹å‘é”® - ç§»åŠ¨
                </p>
                <p>
                    <span class="key">ç©ºæ ¼</span> - å‘å°„å­å¼¹ | <span class="key">R</span> - é‡æ–°å¼€å§‹
                </p>
                <p>
                    <span class="key">ç‚¹å‡»å±å¹•</span> - å¯ç”¨éŸ³é¢‘
                </p>
            </div>

            <div class="audio-controls" style="margin-top: 20px;">
                <h3>ğŸ”Š éŸ³é¢‘æ§åˆ¶</h3>
                <div style="margin: 10px 0;">
                    <label style="color: #00ff00;">ä¸»éŸ³é‡: </label>
                    <input type="range" id="masterVolume" min="0" max="100" value="80"
                           style="width: 150px;" onchange="updateMasterVolume(this.value)">
                    <span id="masterVolumeValue">80%</span>
                </div>
                <div style="margin: 10px 0;">
                    <label style="color: #00ff00;">éŸ³æ•ˆéŸ³é‡: </label>
                    <input type="range" id="sfxVolume" min="0" max="100" value="70"
                           style="width: 150px;" onchange="updateSfxVolume(this.value)">
                    <span id="sfxVolumeValue">70%</span>
                </div>
                <div style="margin: 10px 0;">
                    <label style="color: #00ff00;">éŸ³ä¹éŸ³é‡: </label>
                    <input type="range" id="musicVolume" min="0" max="100" value="30"
                           style="width: 150px;" onchange="updateMusicVolume(this.value)">
                    <span id="musicVolumeValue">30%</span>
                </div>
                <div style="margin: 10px 0;">
                    <button onclick="toggleAudio()" style="
                        background: rgba(0,255,0,0.2);
                        border: 1px solid #00ff00;
                        color: #00ff00;
                        padding: 5px 15px;
                        border-radius: 5px;
                        cursor: pointer;
                    ">ğŸ”Š åˆ‡æ¢éŸ³é¢‘</button>
                </div>
            </div>
        </div>
        
        <div class="instructions">
            <h3>ğŸ¯ æ¸¸æˆç›®æ ‡</h3>
            <p>æ§åˆ¶ç»¿è‰²é£èˆ¹ï¼Œå°„å‡»çº¢è‰²æ•Œäººï¼Œé¿å…ç¢°æ’ï¼</p>
            <p>è¿™æ˜¯ä¸€ä¸ªç»å…¸çš„NESé£æ ¼å°„å‡»æ¸¸æˆ</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');

        // éŸ³é¢‘ç³»ç»Ÿ
        class AudioSystem {
            constructor() {
                this.audioContext = null;
                this.sounds = {};
                this.musicGain = null;
                this.sfxGain = null;
                this.masterGain = null;
                this.initialized = false;
                this.musicVolume = 0.3;
                this.sfxVolume = 0.7;
                this.masterVolume = 0.8;
            }

            async initialize() {
                try {
                    // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();

                    // åˆ›å»ºéŸ³é‡æ§åˆ¶èŠ‚ç‚¹
                    this.masterGain = this.audioContext.createGain();
                    this.musicGain = this.audioContext.createGain();
                    this.sfxGain = this.audioContext.createGain();

                    // è¿æ¥éŸ³é¢‘èŠ‚ç‚¹
                    this.masterGain.connect(this.audioContext.destination);
                    this.musicGain.connect(this.masterGain);
                    this.sfxGain.connect(this.masterGain);

                    // è®¾ç½®åˆå§‹éŸ³é‡
                    this.masterGain.gain.value = this.masterVolume;
                    this.musicGain.gain.value = this.musicVolume;
                    this.sfxGain.gain.value = this.sfxVolume;

                    // ç”ŸæˆéŸ³æ•ˆ
                    await this.generateSounds();

                    this.initialized = true;
                    console.log('ğŸ”Š éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ');

                } catch (error) {
                    console.error('âŒ éŸ³é¢‘ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥:', error);
                }
            }

            async generateSounds() {
                // ç”Ÿæˆå„ç§éŸ³æ•ˆ
                this.sounds.shoot = await this.createTone(800, 0.1, 'square');
                this.sounds.hit = await this.createTone(300, 0.2, 'sawtooth');
                this.sounds.powerup = await this.createChord([440, 554, 659], 0.3);
                this.sounds.explosion = await this.createNoise(0.3);
                this.sounds.gameOver = await this.createTone(200, 1.0, 'triangle');
                this.sounds.background = await this.createBackgroundMusic();
            }

            async createTone(frequency, duration, waveType = 'sine') {
                const sampleRate = this.audioContext.sampleRate;
                const frameCount = sampleRate * duration;
                const buffer = this.audioContext.createBuffer(1, frameCount, sampleRate);
                const data = buffer.getChannelData(0);

                for (let i = 0; i < frameCount; i++) {
                    const t = i / sampleRate;
                    let value;

                    switch (waveType) {
                        case 'square':
                            value = Math.sin(2 * Math.PI * frequency * t) > 0 ? 0.3 : -0.3;
                            break;
                        case 'sawtooth':
                            value = 0.3 * (2 * (frequency * t % 1) - 1);
                            break;
                        case 'triangle':
                            value = 0.3 * (2 * Math.abs(2 * (frequency * t % 1) - 1) - 1);
                            break;
                        default: // sine
                            value = 0.3 * Math.sin(2 * Math.PI * frequency * t);
                    }

                    // æ·»åŠ æ·¡å‡ºæ•ˆæœ
                    const fadeOut = Math.max(0, 1 - (t / duration) * 2);
                    data[i] = value * fadeOut;
                }

                return buffer;
            }

            async createChord(frequencies, duration) {
                const sampleRate = this.audioContext.sampleRate;
                const frameCount = sampleRate * duration;
                const buffer = this.audioContext.createBuffer(1, frameCount, sampleRate);
                const data = buffer.getChannelData(0);

                for (let i = 0; i < frameCount; i++) {
                    const t = i / sampleRate;
                    let value = 0;

                    frequencies.forEach(freq => {
                        value += 0.1 * Math.sin(2 * Math.PI * freq * t);
                    });

                    // æ·»åŠ æ·¡å‡ºæ•ˆæœ
                    const fadeOut = Math.max(0, 1 - (t / duration) * 1.5);
                    data[i] = value * fadeOut;
                }

                return buffer;
            }

            async createNoise(duration) {
                const sampleRate = this.audioContext.sampleRate;
                const frameCount = sampleRate * duration;
                const buffer = this.audioContext.createBuffer(1, frameCount, sampleRate);
                const data = buffer.getChannelData(0);

                for (let i = 0; i < frameCount; i++) {
                    const t = i / sampleRate;
                    const value = (Math.random() * 2 - 1) * 0.2;

                    // æ·»åŠ æ·¡å‡ºæ•ˆæœ
                    const fadeOut = Math.max(0, 1 - (t / duration) * 3);
                    data[i] = value * fadeOut;
                }

                return buffer;
            }

            async createBackgroundMusic() {
                // åˆ›å»ºç®€å•çš„èƒŒæ™¯éŸ³ä¹å¾ªç¯
                const duration = 4.0; // 4ç§’å¾ªç¯
                const sampleRate = this.audioContext.sampleRate;
                const frameCount = sampleRate * duration;
                const buffer = this.audioContext.createBuffer(1, frameCount, sampleRate);
                const data = buffer.getChannelData(0);

                // ç®€å•çš„æ—‹å¾‹
                const melody = [440, 494, 523, 587, 659, 587, 523, 494]; // A, B, C, D, E, D, C, B
                const noteDuration = duration / melody.length;

                for (let i = 0; i < frameCount; i++) {
                    const t = i / sampleRate;
                    const noteIndex = Math.floor(t / noteDuration);
                    const noteTime = (t % noteDuration) / noteDuration;
                    const frequency = melody[noteIndex % melody.length];

                    // ä¸»æ—‹å¾‹
                    let value = 0.1 * Math.sin(2 * Math.PI * frequency * t);

                    // æ·»åŠ å’Œå£°
                    value += 0.05 * Math.sin(2 * Math.PI * (frequency * 0.75) * t);

                    // éŸ³ç¬¦æ·¡å…¥æ·¡å‡º
                    const envelope = Math.sin(Math.PI * noteTime);
                    data[i] = value * envelope;
                }

                return buffer;
            }

            playSound(soundName, volume = 1.0) {
                if (!this.initialized || !this.sounds[soundName]) {
                    return;
                }

                try {
                    const source = this.audioContext.createBufferSource();
                    const gainNode = this.audioContext.createGain();

                    source.buffer = this.sounds[soundName];
                    gainNode.gain.value = volume;

                    source.connect(gainNode);
                    gainNode.connect(this.sfxGain);

                    source.start();
                } catch (error) {
                    console.error('æ’­æ”¾éŸ³æ•ˆå¤±è´¥:', error);
                }
            }

            playBackgroundMusic() {
                if (!this.initialized || !this.sounds.background) {
                    return;
                }

                try {
                    // åœæ­¢å½“å‰èƒŒæ™¯éŸ³ä¹
                    this.stopBackgroundMusic();

                    // åˆ›å»ºå¾ªç¯æ’­æ”¾çš„èƒŒæ™¯éŸ³ä¹
                    this.backgroundSource = this.audioContext.createBufferSource();
                    this.backgroundSource.buffer = this.sounds.background;
                    this.backgroundSource.loop = true;
                    this.backgroundSource.connect(this.musicGain);
                    this.backgroundSource.start();

                    console.log('ğŸµ èƒŒæ™¯éŸ³ä¹å¼€å§‹æ’­æ”¾');
                } catch (error) {
                    console.error('æ’­æ”¾èƒŒæ™¯éŸ³ä¹å¤±è´¥:', error);
                }
            }

            stopBackgroundMusic() {
                if (this.backgroundSource) {
                    try {
                        this.backgroundSource.stop();
                        this.backgroundSource = null;
                    } catch (error) {
                        // å¿½ç•¥å·²åœæ­¢çš„éŸ³æºé”™è¯¯
                    }
                }
            }

            setMasterVolume(volume) {
                this.masterVolume = Math.max(0, Math.min(1, volume));
                if (this.masterGain) {
                    this.masterGain.gain.value = this.masterVolume;
                }
            }

            setSfxVolume(volume) {
                this.sfxVolume = Math.max(0, Math.min(1, volume));
                if (this.sfxGain) {
                    this.sfxGain.gain.value = this.sfxVolume;
                }
            }

            setMusicVolume(volume) {
                this.musicVolume = Math.max(0, Math.min(1, volume));
                if (this.musicGain) {
                    this.musicGain.gain.value = this.musicVolume;
                }
            }
        }

        // åˆ›å»ºéŸ³é¢‘ç³»ç»Ÿå®ä¾‹
        const audioSystem = new AudioSystem();

        // æ¸¸æˆçŠ¶æ€
        let score = 0;
        let gameRunning = true;
        let audioInitialized = false;
        let currentGame = null;
        let currentSystem = null;
        let romDatabase = null;
        let filteredGames = [];

        // å†…ç½®æ¼”ç¤ºæ¸¸æˆæ•°æ®
        const demoGames = {
            'space-shooter': {
                title: 'å¤ªç©ºå°„å‡»',
                icon: 'ğŸš€',
                description: 'ç»å…¸çš„å¤ªç©ºå°„å‡»æ¸¸æˆ',
                gameFunction: startSpaceShooter
            }
        };
        
        // ç©å®¶
        const player = {
            x: canvas.width / 2,
            y: canvas.height - 50,
            width: 30,
            height: 30,
            speed: 5,
            color: '#00ff00'
        };

        // å­å¼¹æ•°ç»„
        const bullets = [];
        const bulletSpeed = 7;

        // æ•Œäººæ•°ç»„
        const enemies = [];
        const enemySpeed = 2;

        // æŒ‰é”®çŠ¶æ€
        const keys = {};

        // åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿ
        async function initializeAudio() {
            if (!audioInitialized) {
                await audioSystem.initialize();
                audioInitialized = true;

                // å¼€å§‹æ’­æ”¾èƒŒæ™¯éŸ³ä¹
                audioSystem.playBackgroundMusic();

                // æ˜¾ç¤ºéŸ³é¢‘çŠ¶æ€
                console.log('ğŸ”Š éŸ³é¢‘ç³»ç»Ÿå·²å¯åŠ¨');
                showAudioStatus();
            }
        }

        function showAudioStatus() {
            const statusDiv = document.createElement('div');
            statusDiv.style.cssText = `
                position: fixed;
                top: 10px;
                left: 10px;
                background: rgba(0, 255, 0, 0.8);
                color: black;
                padding: 5px 10px;
                border-radius: 5px;
                font-size: 12px;
                z-index: 1000;
            `;
            statusDiv.textContent = 'ğŸ”Š éŸ³é¢‘å·²å¯ç”¨';
            document.body.appendChild(statusDiv);

            setTimeout(() => {
                document.body.removeChild(statusDiv);
            }, 2000);
        }

        // äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            if (e.key === ' ') {
                e.preventDefault();
                shootBullet();
            }
            if (e.key.toLowerCase() === 'r') {
                resetGame();
            }

            // åˆå§‹åŒ–éŸ³é¢‘ç³»ç»Ÿï¼ˆéœ€è¦ç”¨æˆ·äº¤äº’ï¼‰
            if (!audioInitialized) {
                initializeAudio();
            }
        });

        // ç‚¹å‡»äº‹ä»¶ä¹Ÿå¯ä»¥åˆå§‹åŒ–éŸ³é¢‘
        document.addEventListener('click', () => {
            if (!audioInitialized) {
                initializeAudio();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        // å°„å‡»å­å¼¹
        function shootBullet() {
            bullets.push({
                x: player.x + player.width / 2,
                y: player.y,
                width: 4,
                height: 10,
                color: '#ffff00'
            });

            // æ’­æ”¾å°„å‡»éŸ³æ•ˆ
            audioSystem.playSound('shoot', 0.5);
        }

        // åˆ›å»ºæ•Œäºº
        function createEnemy() {
            enemies.push({
                x: Math.random() * (canvas.width - 30),
                y: -30,
                width: 25,
                height: 25,
                color: '#ff0000'
            });
        }

        // æ›´æ–°æ¸¸æˆ
        function update() {
            if (!gameRunning) return;

            // ç§»åŠ¨ç©å®¶
            if (keys['w'] || keys['arrowup']) player.y = Math.max(0, player.y - player.speed);
            if (keys['s'] || keys['arrowdown']) player.y = Math.min(canvas.height - player.height, player.y + player.speed);
            if (keys['a'] || keys['arrowleft']) player.x = Math.max(0, player.x - player.speed);
            if (keys['d'] || keys['arrowright']) player.x = Math.min(canvas.width - player.width, player.x + player.speed);

            // æ›´æ–°å­å¼¹
            for (let i = bullets.length - 1; i >= 0; i--) {
                bullets[i].y -= bulletSpeed;
                if (bullets[i].y < 0) {
                    bullets.splice(i, 1);
                }
            }

            // æ›´æ–°æ•Œäºº
            for (let i = enemies.length - 1; i >= 0; i--) {
                enemies[i].y += enemySpeed;
                if (enemies[i].y > canvas.height) {
                    enemies.splice(i, 1);
                }
            }

            // æ£€æŸ¥å­å¼¹ä¸æ•Œäººç¢°æ’
            for (let i = bullets.length - 1; i >= 0; i--) {
                for (let j = enemies.length - 1; j >= 0; j--) {
                    if (bullets[i] && enemies[j] && 
                        bullets[i].x < enemies[j].x + enemies[j].width &&
                        bullets[i].x + bullets[i].width > enemies[j].x &&
                        bullets[i].y < enemies[j].y + enemies[j].height &&
                        bullets[i].y + bullets[i].height > enemies[j].y) {
                        
                        bullets.splice(i, 1);
                        enemies.splice(j, 1);
                        score += 10;
                        scoreElement.textContent = score;

                        // æ’­æ”¾å‡»ä¸­éŸ³æ•ˆ
                        audioSystem.playSound('hit', 0.7);
                        break;
                    }
                }
            }

            // æ£€æŸ¥ç©å®¶ä¸æ•Œäººç¢°æ’
            for (let enemy of enemies) {
                if (player.x < enemy.x + enemy.width &&
                    player.x + player.width > enemy.x &&
                    player.y < enemy.y + enemy.height &&
                    player.y + player.height > enemy.y) {
                    
                    gameRunning = false;

                    // æ’­æ”¾æ¸¸æˆç»“æŸéŸ³æ•ˆ
                    audioSystem.playSound('gameOver', 1.0);
                    audioSystem.stopBackgroundMusic();

                    alert(`æ¸¸æˆç»“æŸï¼æœ€ç»ˆå¾—åˆ†: ${score}\næŒ‰Ré”®é‡æ–°å¼€å§‹`);
                }
            }

            // éšæœºç”Ÿæˆæ•Œäºº
            if (Math.random() < 0.02) {
                createEnemy();
            }
        }

        // ç»˜åˆ¶æ¸¸æˆ
        function draw() {
            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#000011';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ç»˜åˆ¶æ˜Ÿç©ºèƒŒæ™¯
            ctx.fillStyle = '#ffffff';
            for (let i = 0; i < 50; i++) {
                const x = (Date.now() * 0.01 + i * 123) % canvas.width;
                const y = (Date.now() * 0.02 + i * 456) % canvas.height;
                ctx.fillRect(x, y, 1, 1);
            }

            // ç»˜åˆ¶ç©å®¶
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // ç»˜åˆ¶ç©å®¶ç»†èŠ‚
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(player.x + 5, player.y + 5, 20, 5);
            ctx.fillRect(player.x + 12, player.y, 6, 15);

            // ç»˜åˆ¶å­å¼¹
            ctx.fillStyle = '#ffff00';
            for (let bullet of bullets) {
                ctx.fillRect(bullet.x, bullet.y, bullet.width, bullet.height);
            }

            // ç»˜åˆ¶æ•Œäºº
            for (let enemy of enemies) {
                ctx.fillStyle = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
                
                // æ•Œäººç»†èŠ‚
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(enemy.x + 5, enemy.y + 5, 15, 3);
                ctx.fillRect(enemy.x + 10, enemy.y + 15, 5, 8);
            }

            // ç»˜åˆ¶æ¸¸æˆæ ‡é¢˜
            if (!gameRunning) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#ff0000';
                ctx.font = '48px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText('æ¸¸æˆç»“æŸ', canvas.width / 2, canvas.height / 2);
                
                ctx.fillStyle = '#ffffff';
                ctx.font = '24px Courier New';
                ctx.fillText('æŒ‰ R é”®é‡æ–°å¼€å§‹', canvas.width / 2, canvas.height / 2 + 50);
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            score = 0;
            scoreElement.textContent = score;
            gameRunning = true;
            bullets.length = 0;
            enemies.length = 0;
            player.x = canvas.width / 2;
            player.y = canvas.height - 50;

            // æ’­æ”¾å¼€å§‹éŸ³æ•ˆå¹¶é‡æ–°å¼€å§‹èƒŒæ™¯éŸ³ä¹
            audioSystem.playSound('powerup', 0.8);
            if (audioInitialized) {
                audioSystem.playBackgroundMusic();
            }
        }

        // æ¸¸æˆå¾ªç¯
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // éŸ³é¢‘æ§åˆ¶å‡½æ•°
        function updateMasterVolume(value) {
            const volume = value / 100;
            audioSystem.setMasterVolume(volume);
            document.getElementById('masterVolumeValue').textContent = value + '%';
        }

        function updateSfxVolume(value) {
            const volume = value / 100;
            audioSystem.setSfxVolume(volume);
            document.getElementById('sfxVolumeValue').textContent = value + '%';
        }

        function updateMusicVolume(value) {
            const volume = value / 100;
            audioSystem.setMusicVolume(volume);
            document.getElementById('musicVolumeValue').textContent = value + '%';
        }

        function toggleAudio() {
            if (audioInitialized) {
                // åˆ‡æ¢éŸ³é¢‘å¼€å…³
                if (audioSystem.masterVolume > 0) {
                    audioSystem.setMasterVolume(0);
                    document.getElementById('masterVolume').value = 0;
                    document.getElementById('masterVolumeValue').textContent = '0%';
                } else {
                    audioSystem.setMasterVolume(0.8);
                    document.getElementById('masterVolume').value = 80;
                    document.getElementById('masterVolumeValue').textContent = '80%';
                }
            } else {
                initializeAudio();
            }
        }

        // ROMæ•°æ®åº“åŠ è½½
        async function loadROMDatabase() {
            try {
                const response = await fetch('rom_list.json');
                if (response.ok) {
                    romDatabase = await response.json();
                    console.log('ğŸ“š ROMæ•°æ®åº“åŠ è½½æˆåŠŸ:', romDatabase);
                    initializeGameList();
                } else {
                    console.warn('âš ï¸ ROMæ•°æ®åº“åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æ¼”ç¤ºæ¨¡å¼');
                    initializeDemoMode();
                }
            } catch (error) {
                console.warn('âš ï¸ ROMæ•°æ®åº“åŠ è½½å¼‚å¸¸ï¼Œä½¿ç”¨æ¼”ç¤ºæ¨¡å¼:', error);
                initializeDemoMode();
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆåˆ—è¡¨
        function initializeGameList() {
            if (!romDatabase) {
                initializeDemoMode();
                return;
            }

            // å¡«å……ç³»ç»Ÿç­›é€‰å™¨
            const systemFilter = document.getElementById('systemFilter');
            systemFilter.innerHTML = '<option value="">æ‰€æœ‰ç³»ç»Ÿ</option>';

            for (const systemId in romDatabase.systems) {
                const system = romDatabase.systems[systemId];
                const option = document.createElement('option');
                option.value = systemId;
                option.textContent = system.name;
                systemFilter.appendChild(option);
            }

            // æ˜¾ç¤ºç³»ç»Ÿåˆ—è¡¨
            displaySystems();
        }

        // åˆå§‹åŒ–æ¼”ç¤ºæ¨¡å¼
        function initializeDemoMode() {
            console.log('ğŸ® å¯åŠ¨æ¼”ç¤ºæ¨¡å¼');
            const systemList = document.getElementById('systemList');
            systemList.innerHTML = `
                <div class="system-item" onclick="selectDemoGame('space-shooter')">
                    <div class="system-icon">ğŸš€</div>
                    <div class="system-name">æ¼”ç¤ºæ¸¸æˆ</div>
                    <div class="system-desc">å†…ç½®çš„æ¼”ç¤ºæ¸¸æˆ</div>
                    <div class="system-count">1 ä¸ªæ¸¸æˆ</div>
                </div>
            `;
        }

        // æ˜¾ç¤ºç³»ç»Ÿåˆ—è¡¨
        function displaySystems() {
            const systemList = document.getElementById('systemList');
            systemList.innerHTML = '';

            for (const systemId in romDatabase.systems) {
                const system = romDatabase.systems[systemId];

                const systemDiv = document.createElement('div');
                systemDiv.className = 'system-item';
                systemDiv.onclick = () => selectSystem(systemId);

                systemDiv.innerHTML = `
                    <div class="system-icon">${system.icon}</div>
                    <div class="system-name">${system.name}</div>
                    <div class="system-desc">${system.description}</div>
                    <div class="system-count">${system.rom_count} ä¸ªæ¸¸æˆ</div>
                `;

                systemList.appendChild(systemDiv);
            }
        }

        // é€‰æ‹©æ¸¸æˆç³»ç»Ÿ
        function selectSystem(systemId) {
            currentSystem = systemId;
            const system = romDatabase.systems[systemId];

            // æ›´æ–°æ ‡é¢˜
            document.getElementById('currentSystemTitle').textContent = system.name;
            document.getElementById('gameCount').textContent = system.rom_count;

            // éšè—ç³»ç»Ÿåˆ—è¡¨ï¼Œæ˜¾ç¤ºæ¸¸æˆåˆ—è¡¨
            document.getElementById('systemList').style.display = 'none';
            document.getElementById('gameListContainer').style.display = 'block';

            // æ˜¾ç¤ºæ¸¸æˆåˆ—è¡¨
            displayGames(system.games);

            // æ’­æ”¾é€‰æ‹©éŸ³æ•ˆ
            audioSystem.playSound('select', 0.8);
        }

        // æ˜¾ç¤ºæ¸¸æˆåˆ—è¡¨
        function displayGames(games) {
            const gameGrid = document.getElementById('gameGrid');
            gameGrid.innerHTML = '';

            filteredGames = games;

            games.forEach((game, index) => {
                const gameDiv = document.createElement('div');
                gameDiv.className = 'game-item';
                gameDiv.onclick = () => selectROMGame(game, index);

                const gameType = game.demo ? 'æ¼”ç¤ºç‰ˆ' : 'å®Œæ•´ç‰ˆ';
                const typeClass = game.demo ? 'demo' : 'full';

                gameDiv.innerHTML = `
                    <div class="game-icon">ğŸ®</div>
                    <div class="game-title">${game.name}</div>
                    <div class="game-desc">${game.description}</div>
                    <div class="game-type ${typeClass}">${gameType}</div>
                    <div class="game-size">${game.size}</div>
                `;

                gameGrid.appendChild(gameDiv);
            });
        }

        // è¿”å›ç³»ç»Ÿé€‰æ‹©
        function backToSystems() {
            document.getElementById('systemList').style.display = 'grid';
            document.getElementById('gameListContainer').style.display = 'none';
            currentSystem = null;

            // æ’­æ”¾è¿”å›éŸ³æ•ˆ
            audioSystem.playSound('beep', 0.6);
        }

        // æ¸¸æˆé€‰æ‹©å’Œåˆ‡æ¢å‡½æ•°
        function selectGame(gameId) {
            if (demoGames[gameId]) {
                currentGame = gameId;

                // éšè—æ¸¸æˆåˆ—è¡¨ï¼Œæ˜¾ç¤ºæ¸¸æˆç•Œé¢
                document.getElementById('gameList').style.display = 'none';
                document.getElementById('gameInterface').style.display = 'block';

                // æ›´æ–°æ¸¸æˆæ ‡é¢˜
                document.getElementById('currentGameTitle').textContent = demoGames[gameId].title;

                // é‡ç½®å¾—åˆ†
                score = 0;
                document.getElementById('score').textContent = score;

                // æ’­æ”¾é€‰æ‹©éŸ³æ•ˆ
                audioSystem.playSound('select', 0.8);

                // å¯åŠ¨é€‰ä¸­çš„æ¸¸æˆ
                demoGames[gameId].gameFunction();

                console.log(`ğŸ® å¯åŠ¨æ¸¸æˆ: ${demoGames[gameId].title}`);
            }
        }

        // é€‰æ‹©ROMæ¸¸æˆ
        function selectROMGame(game, index) {
            currentGame = `${currentSystem}_${index}`;

            // éšè—æ¸¸æˆåˆ—è¡¨ï¼Œæ˜¾ç¤ºæ¸¸æˆç•Œé¢
            document.getElementById('gameList').style.display = 'none';
            document.getElementById('gameInterface').style.display = 'block';

            // æ›´æ–°æ¸¸æˆæ ‡é¢˜
            document.getElementById('currentGameTitle').textContent = game.name;

            // é‡ç½®å¾—åˆ†
            score = 0;
            document.getElementById('score').textContent = score;

            // æ’­æ”¾é€‰æ‹©éŸ³æ•ˆ
            audioSystem.playSound('select', 0.8);

            // å¯åŠ¨ROMæ¸¸æˆï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼‰
            startROMGame(game);

            console.log(`ğŸ® å¯åŠ¨ROMæ¸¸æˆ: ${game.name}`);
        }

        // é€‰æ‹©æ¼”ç¤ºæ¸¸æˆ
        function selectDemoGame(gameId) {
            selectGame(gameId);
        }

        // æœç´¢å’Œç­›é€‰åŠŸèƒ½
        function filterGames() {
            const searchTerm = document.getElementById('gameSearch').value.toLowerCase();

            if (!currentSystem || !romDatabase) {
                return;
            }

            const system = romDatabase.systems[currentSystem];
            let filtered = system.games;

            if (searchTerm) {
                filtered = system.games.filter(game =>
                    game.name.toLowerCase().includes(searchTerm) ||
                    game.description.toLowerCase().includes(searchTerm)
                );
            }

            displayGames(filtered);
            document.getElementById('gameCount').textContent = filtered.length;
        }

        // æŒ‰ç³»ç»Ÿç­›é€‰
        function filterBySystem() {
            const selectedSystem = document.getElementById('systemFilter').value;

            if (!selectedSystem) {
                displaySystems();
                return;
            }

            selectSystem(selectedSystem);
        }

        // æ˜¾ç¤ºè®¾ç½®ç•Œé¢
        function showSettings() {
            // éšè—æ¸¸æˆåˆ—è¡¨ï¼Œæ˜¾ç¤ºè®¾ç½®ç•Œé¢
            document.getElementById('gameList').style.display = 'none';
            document.getElementById('settingsInterface').style.display = 'block';

            // åˆå§‹åŒ–è®¾ç½®ç•Œé¢
            initializeSettings();

            // æ’­æ”¾é€‰æ‹©éŸ³æ•ˆ
            audioSystem.playSound('select', 0.8);
        }

        // åˆå§‹åŒ–è®¾ç½®ç•Œé¢
        function initializeSettings() {
            // å¡«å……é‡‘æ‰‹æŒ‡ç³»ç»Ÿé€‰æ‹©å™¨
            const cheatSystemSelect = document.getElementById('cheatSystemSelect');
            cheatSystemSelect.innerHTML = '<option value="">è¯·é€‰æ‹©ç³»ç»Ÿ</option>';

            if (romDatabase && romDatabase.systems) {
                for (const systemId in romDatabase.systems) {
                    const system = romDatabase.systems[systemId];
                    const option = document.createElement('option');
                    option.value = systemId;
                    option.textContent = system.name;
                    cheatSystemSelect.appendChild(option);
                }
            }

            // åˆå§‹åŒ–éŸ³é‡æ»‘å—
            const volumeSlider = document.getElementById('volumeSlider');
            const volumeValue = document.getElementById('volumeValue');
            volumeSlider.oninput = function() {
                volumeValue.textContent = this.value;
                audioSystem.setMasterVolume(this.value / 100);
            };
        }

        // åŠ è½½ç³»ç»Ÿé‡‘æ‰‹æŒ‡
        function loadSystemCheats() {
            const systemId = document.getElementById('cheatSystemSelect').value;
            const cheatList = document.getElementById('cheatList');

            if (!systemId) {
                cheatList.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">è¯·å…ˆé€‰æ‹©æ¸¸æˆç³»ç»Ÿ</div>';
                return;
            }

            // æ¨¡æ‹Ÿé‡‘æ‰‹æŒ‡æ•°æ®ï¼ˆå®é™…é¡¹ç›®ä¸­ä¼šä»æœåŠ¡å™¨åŠ è½½ï¼‰
            const systemCheats = {
                "nes": {
                    "infinite_lives": {
                        "name": "æ— é™ç”Ÿå‘½",
                        "description": "è·å¾—æ— é™ç”Ÿå‘½æ•°",
                        "code": "AEAEAE",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "infinite_time": {
                        "name": "æ— é™æ—¶é—´",
                        "description": "æ—¶é—´ä¸ä¼šå‡å°‘",
                        "code": "AAAAAA",
                        "enabled": false,
                        "auto_enable": false
                    },
                    "invincibility": {
                        "name": "æ— æ•Œæ¨¡å¼",
                        "description": "è§’è‰²æ— æ•Œï¼Œä¸ä¼šå—ä¼¤",
                        "code": "AEAEAE",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "level_select": {
                        "name": "å…³å¡é€‰æ‹©",
                        "description": "å¯ä»¥é€‰æ‹©ä»»æ„å…³å¡",
                        "code": "AAAAAA",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "max_power": {
                        "name": "æœ€å¤§èƒ½åŠ›",
                        "description": "æ‰€æœ‰èƒ½åŠ›å€¼æœ€å¤§",
                        "code": "AEAEAE",
                        "enabled": true,
                        "auto_enable": true
                    }
                },
                "snes": {
                    "infinite_lives": {
                        "name": "æ— é™ç”Ÿå‘½",
                        "description": "è·å¾—æ— é™ç”Ÿå‘½æ•°",
                        "code": "7E0DBE:63",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "infinite_health": {
                        "name": "æ— é™è¡€é‡",
                        "description": "è¡€é‡ä¸ä¼šå‡å°‘",
                        "code": "7E0DBF:FF",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "invincibility": {
                        "name": "æ— æ•Œæ¨¡å¼",
                        "description": "è§’è‰²æ— æ•Œï¼Œä¸ä¼šå—ä¼¤",
                        "code": "7E0DC0:01",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "max_power": {
                        "name": "æœ€å¤§èƒ½åŠ›",
                        "description": "æ‰€æœ‰èƒ½åŠ›å€¼æœ€å¤§",
                        "code": "7E0DC0:FF",
                        "enabled": true,
                        "auto_enable": true
                    },
                    "level_select": {
                        "name": "å…³å¡é€‰æ‹©",
                        "description": "å¯ä»¥é€‰æ‹©ä»»æ„å…³å¡",
                        "code": "7E0DC1:FF",
                        "enabled": true,
                        "auto_enable": true
                    }
                }
            };

            const cheats = systemCheats[systemId] || {};

            if (Object.keys(cheats).length === 0) {
                cheatList.innerHTML = '<div style="color: #888; text-align: center; padding: 20px;">è¯¥ç³»ç»Ÿæš‚æ— å¯ç”¨é‡‘æ‰‹æŒ‡</div>';
                return;
            }

            cheatList.innerHTML = '';

            for (const cheatId in cheats) {
                const cheat = cheats[cheatId];

                const cheatDiv = document.createElement('div');
                cheatDiv.className = 'cheat-item';

                // æ·»åŠ è‡ªåŠ¨å¯ç”¨æ ‡è¯†
                const autoEnableLabel = cheat.auto_enable ? '<span class="auto-enable-label">ğŸ”„ è‡ªåŠ¨å¯ç”¨</span>' : '';

                cheatDiv.innerHTML = `
                    <div class="cheat-info">
                        <div class="cheat-name">${cheat.name} ${autoEnableLabel}</div>
                        <div class="cheat-desc">${cheat.description}</div>
                        <div class="cheat-code">ä»£ç : ${cheat.code}</div>
                    </div>
                    <div class="cheat-toggle">
                        <input type="checkbox" id="cheat_${systemId}_${cheatId}"
                               ${cheat.enabled ? 'checked' : ''}
                               onchange="toggleCheat('${systemId}', '${cheatId}', this.checked)">
                    </div>
                `;

                cheatList.appendChild(cheatDiv);
            }
        }

        // åˆ‡æ¢é‡‘æ‰‹æŒ‡çŠ¶æ€
        function toggleCheat(systemId, cheatId, enabled) {
            console.log(`ğŸ¯ ${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}é‡‘æ‰‹æŒ‡: ${systemId} - ${cheatId}`);

            // æ’­æ”¾éŸ³æ•ˆ
            audioSystem.playSound(enabled ? 'powerup' : 'beep', 0.6);

            // è¿™é‡Œåº”è¯¥è°ƒç”¨åç«¯APIæ¥å®é™…å¯ç”¨/ç¦ç”¨é‡‘æ‰‹æŒ‡
            // ç›®å‰åªæ˜¯æ¼”ç¤ºåŠŸèƒ½
        }

        // å¯ç”¨æ‰€æœ‰é‡‘æ‰‹æŒ‡
        function enableAllCheats() {
            const systemId = document.getElementById('cheatSystemSelect').value;
            if (!systemId) {
                alert('è¯·å…ˆé€‰æ‹©æ¸¸æˆç³»ç»Ÿ');
                return;
            }

            const checkboxes = document.querySelectorAll('#cheatList input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
                checkbox.onchange();
            });

            console.log('ğŸ¯ å·²å¯ç”¨æ‰€æœ‰é‡‘æ‰‹æŒ‡');
            audioSystem.playSound('powerup', 0.8);
        }

        // ç¦ç”¨æ‰€æœ‰é‡‘æ‰‹æŒ‡
        function disableAllCheats() {
            const checkboxes = document.querySelectorAll('#cheatList input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.onchange();
            });

            console.log('ğŸš« å·²ç¦ç”¨æ‰€æœ‰é‡‘æ‰‹æŒ‡');
            audioSystem.playSound('beep', 0.6);
        }

        // é‡ç½®é‡‘æ‰‹æŒ‡è®¾ç½®
        function resetCheats() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰é‡‘æ‰‹æŒ‡è®¾ç½®å—ï¼Ÿ')) {
                disableAllCheats();
                console.log('ğŸ”„ é‡‘æ‰‹æŒ‡è®¾ç½®å·²é‡ç½®');
                audioSystem.playSound('beep', 0.8);
            }
        }

        // æ ¡å‡†æ‰‹æŸ„
        function calibrateGamepad() {
            alert('ğŸ® æ‰‹æŸ„æ ¡å‡†åŠŸèƒ½\n\n1. ç¡®ä¿æ‰‹æŸ„å·²è¿æ¥\n2. æŒ‰ä½æ‰€æœ‰æŒ‰é”®5ç§’\n3. æ¾å¼€æ‰€æœ‰æŒ‰é”®\n4. æ ¡å‡†å®Œæˆ');
        }

        // å¯åŠ¨ROMæ¸¸æˆï¼ˆæ¼”ç¤ºï¼‰
        function startROMGame(game) {
            // æ˜¾ç¤ºæ¸¸æˆä¿¡æ¯
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');

            // æ¸…ç©ºç”»å¸ƒ
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // æ˜¾ç¤ºæ¸¸æˆä¿¡æ¯
            ctx.fillStyle = '#00ff00';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(`ğŸ® ${game.name}`, canvas.width/2, 80);

            ctx.font = '16px Arial';
            ctx.fillText(`ç³»ç»Ÿ: ${romDatabase.systems[currentSystem].name}`, canvas.width/2, 120);
            ctx.fillText(`æè¿°: ${game.description}`, canvas.width/2, 150);
            ctx.fillText(`å¤§å°: ${game.size}`, canvas.width/2, 180);
            ctx.fillText(`ç±»å‹: ${game.demo ? 'æ¼”ç¤ºç‰ˆ' : 'å®Œæ•´ç‰ˆ'}`, canvas.width/2, 210);

            // æ˜¾ç¤ºè‡ªåŠ¨å¯ç”¨çš„é‡‘æ‰‹æŒ‡
            ctx.fillStyle = '#ffaa00';
            ctx.font = '18px Arial';
            ctx.fillText('ğŸ¯ è‡ªåŠ¨å¯ç”¨é‡‘æ‰‹æŒ‡:', canvas.width/2, 260);

            ctx.fillStyle = '#00ff88';
            ctx.font = '14px Arial';
            const autoEnabledCheats = [
                'âœ… æ— é™ç”Ÿå‘½ - æ°¸ä¸æ­»äº¡',
                'âœ… æ— æ•Œæ¨¡å¼ - å…ç–«ä¼¤å®³',
                'âœ… æœ€å¤§èƒ½åŠ› - èƒ½åŠ›å€¼æœ€å¤§',
                'âœ… å…³å¡é€‰æ‹© - ä»»æ„å…³å¡'
            ];

            autoEnabledCheats.forEach((cheat, index) => {
                ctx.fillText(cheat, canvas.width/2, 290 + index * 25);
            });

            ctx.fillStyle = '#ffaa00';
            ctx.font = '16px Arial';
            ctx.fillText('ğŸš§ æ¨¡æ‹Ÿå™¨åŠŸèƒ½å¼€å‘ä¸­...', canvas.width/2, 420);

            ctx.fillStyle = '#88ff88';
            ctx.font = '14px Arial';
            ctx.fillText('æŒ‰ ESC é”®è¿”å›æ¸¸æˆåˆ—è¡¨', canvas.width/2, 450);

            // æ¨¡æ‹Ÿæ¸¸æˆè¿è¡Œ
            gameRunning = true;

            // æ’­æ”¾å¯åŠ¨éŸ³æ•ˆ
            audioSystem.playSound('powerup', 0.8);

            // æ·»åŠ é”®ç›˜ç›‘å¬
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && currentGame && currentGame.includes('_')) {
                    backToGameList();
                }
            });
        }

        function backToGameList() {
            // åœæ­¢å½“å‰æ¸¸æˆ
            gameRunning = false;

            // æ˜¾ç¤ºæ¸¸æˆåˆ—è¡¨ï¼Œéšè—å…¶ä»–ç•Œé¢
            document.getElementById('gameList').style.display = 'block';
            document.getElementById('gameInterface').style.display = 'none';
            document.getElementById('settingsInterface').style.display = 'none';

            // æ’­æ”¾è¿”å›éŸ³æ•ˆ
            audioSystem.playSound('beep', 0.6);

            currentGame = null;
            console.log('ğŸ”™ è¿”å›æ¸¸æˆåˆ—è¡¨');
        }

        // æ¸¸æˆå®ç°å‡½æ•°
        function startSpaceShooter() {
            // å½“å‰çš„å¤ªç©ºå°„å‡»æ¸¸æˆé€»è¾‘
            gameRunning = true;
            gameLoop();
        }

        function startTetris() {
            // ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
            gameRunning = true;
            alert('ğŸ§© ä¿„ç½—æ–¯æ–¹å—æ¸¸æˆå³å°†æ¨å‡ºï¼');
            backToGameList();
        }

        function startSnake() {
            // è´ªåƒè›‡æ¸¸æˆé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
            gameRunning = true;
            alert('ğŸ è´ªåƒè›‡æ¸¸æˆå³å°†æ¨å‡ºï¼');
            backToGameList();
        }

        function startMario() {
            // è¶…çº§é©¬é‡Œå¥¥æ¸¸æˆé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
            gameRunning = true;
            alert('ğŸ„ è¶…çº§é©¬é‡Œå¥¥æ¸¸æˆå³å°†æ¨å‡ºï¼');
            backToGameList();
        }

        function startPacman() {
            // åƒè±†äººæ¸¸æˆé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
            gameRunning = true;
            alert('ğŸ‘» åƒè±†äººæ¸¸æˆå³å°†æ¨å‡ºï¼');
            backToGameList();
        }

        function startContra() {
            // é­‚æ–—ç½—æ¸¸æˆé€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
            gameRunning = true;
            alert('ğŸ”« é­‚æ–—ç½—æ¸¸æˆå³å°†æ¨å‡ºï¼');
            backToGameList();
        }

        // å¯åŠ¨æ¸¸æˆç³»ç»Ÿ
        console.log('ğŸ® GamePlayer-Raspberry æµè§ˆå™¨æ¸¸æˆå¯åŠ¨!');

        // åŠ è½½ROMæ•°æ®åº“
        loadROMDatabase();

        // æ˜¾ç¤ºæ¸¸æˆåˆ—è¡¨ï¼ˆé»˜è®¤ç•Œé¢ï¼‰
        document.getElementById('gameList').style.display = 'block';
        document.getElementById('gameInterface').style.display = 'none';
    </script>
</body>
</html>
